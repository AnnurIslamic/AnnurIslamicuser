<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Annur Islamic</title>
  <link rel="icon" href="logo-annur.jpg" type="image/jpg">
  <link rel="manifest" href="manifest.json">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <style>
    :root {
      --primary-bg: #f0f4f8;
      --header-bg: #0d264a;
      --header-text: #ffffff;
      --accent-color: #f9d788;
      --text-color: #333333;
      --text-light: #888;
      --card-bg: #ffffff;
      --card-shadow: rgba(0, 0, 0, 0.08);
      --radius: 12px;
      --transition: 0.3s ease;
      --active-tab: #0d264a;
      --bookmark-active: #ffc107;
      --tap-area-bg: #e9eef2;
      --button-bg: #0d264a;
      --button-text: #ffffff;
    }

    /* ... CSS Anda yang sudah ada ... */

/* [BARU] CSS untuk Highlight Ayat Aktif */
.ayah-item.ayah-playing {
    background-color: var(--tap-area-bg);
    border-radius: var(--radius);
}
body.dark-mode .ayah-item.ayah-playing {
    background-color: #2c2c3a;
}

    .app-footer {
      text-align: center;
      margin-top: 2rem;
      font-size: 0.9rem;
      color: var(--text-light);
      font-weight: 500;
    }

    body.dark-mode {
      --primary-bg: #121212;
      --header-bg: #1a1a2e;
      --header-text: #e0e0e0;
      --text-color: #e0e0e0;
      --text-light: #aaa;
      --card-bg: #1e1e1e;
      --card-shadow: rgba(255, 255, 255, 0.05);
      --active-tab: #f9d788;
      --tap-area-bg: #2c2c3a;
      --button-bg: #f9d788;
      --button-text: #1a1a2e;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Poppins', sans-serif;
      color: var(--text-color);
      background-color: var(--primary-bg);
      -webkit-user-select: none; user-select: none;
      transition: background-color var(--transition), color var(--transition);
    }
    .app-container { width: 100%; max-width: 420px; margin: 0 auto; overflow-x: hidden; }
    .loading-indicator { text-align: center; padding: 2rem; color: var(--text-light); }

    /* --- COMMON VIEW STYLES --- */
    .view-header { display: flex; align-items: center; margin-bottom: 1.5rem; position: relative; justify-content: space-between; padding: 0 1rem; }
    .back-button { position: absolute; left: 1rem; top: 50%; transform: translateY(-50%); font-size: 1.5rem; cursor: pointer; color: var(--text-color); padding: 0.5rem; z-index: 5; }
    .view-header h2 { font-size: 1.2rem; font-weight: 600; text-align: center; flex-grow: 1; }
    .view-header .action-icon { font-size: 1.5rem; cursor: pointer; color: var(--text-light); padding: 0.5rem; }
    .view-header .action-icon.bookmarked { color: var(--bookmark-active); }
    

    /* --- LAYAR UTAMA (JADWAL SHOLAT) --- */
    #prayer-times-view { padding-bottom: 2rem; }
    #prayer-times-view .main-header {
      background: var(--header-bg); color: var(--header-text); padding: 1.5rem 1.5rem 2.5rem 1.5rem;
      border-bottom-left-radius: 40px; border-bottom-right-radius: 40px; text-align: center;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2); position: relative; transition: background-color var(--transition);
    }
    #prayer-times-view .main-header h1 { font-size: 1.5rem; font-weight: 700; color: var(--accent-color); margin-bottom: 0.25rem; }
    #prayer-times-view .main-header p { font-size: 0.9rem; color: var(--header-text); opacity: 0.9; margin-bottom: 0.5rem; }
    #prayer-times-view #countdown-timer { font-size: 2.25rem; font-weight: 700; color: var(--header-text); letter-spacing: 2px; }
    
    #prayer-times-view .main-header #location-display {
        display: flex;
        align-items: center;
        justify-content: flex-start;
        padding-top: 1.5rem;
        text-align: left;
        font-size: 0.9rem;
        font-weight: 500;
        color: var(--header-text);
        opacity: 0.9;
    }
    
    #prayer-times-view .calendar-section {
        background-color: var(--card-bg);
        border-radius: var(--radius);
        margin: -2.5rem 1rem 1.5rem 1rem;
        padding: 1rem;
        box-shadow: 0 4px 10px var(--card-shadow);
        position: relative;
        z-index: 10;
        transition: background-color var(--transition);
    }

    #prayer-times-view #location-display .icon { margin-right: 0.4rem; }
    #prayer-times-view .date-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; font-size: 0.9rem; font-weight: 600; }
    #prayer-times-view .date-header .hijri-date { color: var(--header-bg); }
    #prayer-times-view .date-header .gregorian-date { color: var(--text-light); font-weight: 400; }
    #prayer-times-view .calendar-view { display: flex; justify-content: space-around; text-align: center; }
    #prayer-times-view .day { display: flex; flex-direction: column; align-items: center; }
    #prayer-times-view .day .day-name { font-size: 0.75rem; color: #999; margin-bottom: 0.5rem; }
    #prayer-times-view .day .day-number { font-size: 1rem; font-weight: 600; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; border-radius: 50%; }
    #prayer-times-view .day.today .day-number { background-color: var(--header-bg); color: var(--header-text); }
    #prayer-times-view .prayer-list-section { padding: 0 1rem; }
    #prayer-times-view .prayer-item { display: flex; align-items: center; justify-content: space-between; background-color: var(--card-bg); padding: 1rem; border-radius: var(--radius); margin-bottom: 0.75rem; box-shadow: 0 2px 5px var(--card-shadow); transition: transform var(--transition), background-color var(--transition); }
    #prayer-times-view .prayer-details { flex-grow: 1; min-width: 0; }
    #prayer-times-view .prayer-details .prayer-name { font-weight: 600; font-size: 1rem; }
    #prayer-times-view .prayer-time-value { font-size: 1.1rem; font-weight: 600; }
    


    /* --- GENERIC LIST VIEW STYLES (DOA, QURAN, DZIKIR) --- */
    .generic-list-view { padding-top: 1.5rem; padding-bottom: 2rem; }
    .last-read-card { background-color: var(--card-bg); border-radius: var(--radius); padding: 1rem; margin: 0 1rem 1.5rem 1rem; box-shadow: 0 2px 5px var(--card-shadow); cursor: pointer;}
    .last-read-card h3 { font-size: 0.8rem; text-transform: uppercase; color: var(--text-light); margin-bottom: 0.5rem; font-weight: 500; }
    .last-read-card p { font-weight: 600; font-size: 1rem; }
    .tabs-container { display: flex; border-bottom: 2px solid #e0e0e0; margin: 0 1rem 1rem 1rem; }
    body.dark-mode .tabs-container { border-bottom-color: #333; }
    .tab-item { flex: 1; text-align: center; padding: 0.8rem 0; font-weight: 600; font-size: 0.9rem; color: var(--text-light); cursor: pointer; position: relative; }
    .tab-item.active { color: var(--active-tab); }
    .tab-item.active::after { content: ''; position: absolute; bottom: -2px; left: 0; width: 100%; height: 2px; background-color: var(--active-tab); }
    .list-container { padding: 0 0.5rem; }
    .list-item { display: flex; align-items: center; padding: 0.8rem 0.5rem; border-bottom: 1px solid #eee; cursor: pointer; }
    body.dark-mode .list-item { border-bottom-color: #333; }
    .list-item .num { font-weight: 500; color: var(--text-light); width: 2.5rem; flex-shrink: 0; text-align: center; }
    .list-item .details { flex-grow: 1; min-width: 0; margin-right: 0.5rem; }
    .list-item .details .title { font-weight: 600; }
    .list-item .details .subtitle { font-size: 0.8rem; color: var(--text-light); }
    .list-item .arabic { font-size: 1.2rem; font-weight: 500; color: var(--text-color); white-space: nowrap; }
    
    /* --- TAMPILAN DZIKIR (List view is now generic) --- */
    #dzikir-view { padding-top: 1.5rem; padding-bottom: 2rem; }

    /* --- TAMPILAN TASBIH --- */
    #tasbih-view { display: none; flex-direction: column; height: 100vh; padding-top: 1.5rem; }
    #tasbih-view .view-header { flex-shrink: 0; margin-bottom: 0; }
    #tasbih-view .tasbih-main { flex-grow: 1; display: flex; flex-direction: column; justify-content: space-evenly; align-items: center; padding: 1rem; }
    #tasbih-counter-display { text-align: center; }
    #tasbih-counter-display .count { font-size: 4rem; font-weight: 700; line-height: 1; }
    #tasbih-counter-display .target { font-size: 1.2rem; color: var(--text-light); }
    #tasbih-text-display { text-align: center; padding: 0 1rem; }
    #tasbih-text-display .tasbih-arabic { font-size: 1.8rem; font-weight: 500; margin-bottom: 0.5rem; }
    #tasbih-text-display .tasbih-latin { font-size: 1rem; font-style: italic; color: var(--text-light); margin-bottom: 0.25rem; }
    #tasbih-text-display .tasbih-arti { font-size: 0.9rem; color: var(--text-light); }
    #tasbih-tap-area { width: 180px; height: 180px; background-color: var(--tap-area-bg); border-radius: 50%; display: flex; justify-content: center; align-items: center; cursor: pointer; box-shadow: 0 5px 15px var(--card-shadow); transition: transform 0.1s ease; }
    #tasbih-tap-area:active { transform: scale(0.95); }
    #tasbih-tap-area .tap-icon { font-size: 4rem; color: var(--text-light); }
    #tasbih-reset-btn { background: none; border: 2px solid var(--text-light); color: var(--text-light); font-size: 1rem; padding: 0.6rem 1.5rem; border-radius: 2rem; cursor: pointer; transition: background-color var(--transition); }
    #tasbih-reset-btn:active { background-color: rgba(136, 136, 136, 0.2); }

    /* --- SIDEBAR & MODAL (CSS UMUM) --- */
    #menu-toggle { position: absolute; top: 1.2rem; left: 1.2rem; width: 40px; height: 40px; background: rgba(255, 255, 255, 0.15); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: var(--radius); cursor: pointer; z-index: 2000; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 8px; transition: all var(--transition); }
    #menu-toggle .bar { display: block; width: 100%; height: 2px; background: var(--header-text); margin: 3px 0; transition: all var(--transition); border-radius: 2px; }
    #sidebar { position: fixed; top: 0; left: -300px; width: 280px; height: 100%; background: var(--card-bg); box-shadow: 4px 0 15px rgba(0, 0, 0, 0.1); padding: 1.5rem; transition: left var(--transition), background-color var(--transition); z-index: 1500; overflow-y: auto; }
    #sidebar.open { left: 0; }
    #sidebar h3 { font-size: 1.2rem; font-weight: 600; color: var(--header-bg); margin-top: 3rem; margin-bottom: 1.5rem; }
    #sidebar ul { list-style: none; padding: 0; }
    #sidebar ul li a { display: block; padding: 0.8rem 1rem; text-decoration: none; color: var(--text-color); font-weight: 500; border-radius: var(--radius); transition: background-color var(--transition), color var(--transition); }
    #sidebar ul li a:hover, #sidebar ul li a.active { background-color: var(--header-bg); color: var(--header-text); }
    
    .full-modal { position: fixed; z-index: 3000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.6); display: none; align-items: center; justify-content: center; }
    .full-modal .modal-content { background-color: var(--primary-bg); color: var(--text-color); padding: 0; border-radius: var(--radius); width: 90%; max-width: 400px; max-height: 85%; box-shadow: 0 5px 20px rgba(0,0,0,0.2); animation: modal-appear 0.4s ease; display: flex; flex-direction: column; }
    @keyframes modal-appear { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
    .full-modal .modal-header { display: flex; justify-content: space-between; align-items: center; padding: 1rem 1.5rem; border-bottom: 1px solid #ddd; }
    body.dark-mode .full-modal .modal-header { border-bottom-color: #444; }
    .full-modal .modal-header h3 { color: var(--header-bg); font-size: 1.1rem; flex-grow: 1; text-align: center; margin: 0 1rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .full-modal .close-button { font-size: 2rem; color: #aaa; cursor: pointer; font-weight: 300; }
    .full-modal .modal-header .action-icon { font-size: 1.5rem; cursor: pointer; color: var(--text-light); }
    .full-modal .modal-header .action-icon.bookmarked { color: var(--bookmark-active); }
    .full-modal .modal-body { padding: 1.5rem; overflow-y: auto; flex-grow: 1; }

    /* --- [BARU] CSS untuk Modal Izin Kustom --- */
    .permission-modal-content {
        padding: 1.5rem;
        text-align: center;
    }
    .permission-modal-content h3 {
        font-size: 1.3rem;
        margin-bottom: 1rem;
        color: var(--header-bg);
    }
    body.dark-mode .permission-modal-content h3 {
        color: var(--accent-color);
    }
    .permission-modal-content p {
        font-size: 0.95rem;
        line-height: 1.6;
        margin-bottom: 1.5rem;
        color: var(--text-color);
        opacity: 0.9;
    }
    .permission-modal-actions {
        display: flex;
        gap: 1rem;
        justify-content: center;
    }
    .permission-modal-actions .modal-action-btn {
        flex-grow: 1;
    }
    .permission-modal-actions .deny-btn {
        background-color: var(--tap-area-bg);
        color: var(--text-color);
    }

    /* STYLE KONTEN MODAL & SURAH VIEW */
    .settings-item { display: flex; justify-content: space-between; align-items: center; padding: 1rem 0; border-bottom: 1px solid #eee; }
    body.dark-mode .settings-item { border-bottom-color: #333; }
    .settings-item:last-child { border-bottom: none; }
    .settings-item label { font-weight: 500; flex-shrink: 0; margin-right: 1rem; }
    .switch { position: relative; display: inline-block; width: 50px; height: 28px; }
    .switch input { opacity: 0; width: 0; height: 0; }
    .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; border-radius: 28px; transition: var(--transition); }
    .slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 4px; bottom: 4px; background-color: white; border-radius: 50%; transition: var(--transition); }
    input:checked + .slider { background-color: var(--header-bg); }
    input:checked + .slider:before { transform: translateX(22px); }
    .custom-select, #enable-notifications-btn {
        padding: 0.5rem; border-radius: 8px; border: 1px solid #ccc; background-color: var(--card-bg); color: var(--text-color);
        font-family: 'Poppins', sans-serif;
    }
    
    #enable-notifications-btn { cursor: pointer; }
    #enable-notifications-btn:disabled { cursor: not-allowed; opacity: 0.6; }
    body.dark-mode .custom-select, body.dark-mode #enable-notifications-btn { border-color: #555; }
    .single-item-arabic { font-size: 2rem; line-height: 3rem; text-align: right; direction: rtl; margin-bottom: 1.5rem; }
    .single-item-latin { font-size: 1rem; font-style: italic; color: #666; line-height: 1.6rem; margin-bottom: 1rem; }
    .single-item-arti { font-size: 0.9rem; color: #666; line-height: 1.5rem; }
    body.dark-mode .single-item-latin { color: #ccc; }
    body.dark-mode .single-item-arti { color: #ccc; }
    .modal-action-btn {
        display: block; width: 100%; padding: 0.8rem; margin-top: 1.5rem;
        background-color: var(--button-bg); color: var(--button-text);
        border: none; border-radius: var(--radius); font-size: 1rem; font-weight: 600;
        cursor: pointer; text-align: center; transition: transform 0.2s ease;
    }
    .modal-action-btn:active { transform: scale(0.98); }

    /* STYLE UNTUK GRUP PENGATURAN */
    .settings-group {
        margin-bottom: 1.5rem;
        padding: 1rem;
        background-color: var(--card-bg);
        border-radius: var(--radius);
        box-shadow: 0 2px 5px var(--card-shadow);
    }
    .settings-group:last-child {
        margin-bottom: 0;
    }
    body.dark-mode .settings-group { border-top-color: #444; }
    .settings-group h4 {
        font-size: 1.1rem;
        font-weight: 600;
        color: var(--header-bg);
        margin-bottom: 1rem;
        padding-bottom: 0.75rem;
        border-bottom: 1px solid #eee;
    }
    body.dark-mode .settings-group h4 { color: var(--accent-color); border-bottom-color: #444;}


    /* STYLE UNTUK MENU DETAIL APLIKASI & PENGATURAN ADZAN BARU */
    .settings-menu-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.9rem 0;
      border-bottom: 1px solid #eee;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }
    .settings-menu-item:last-child {
      border-bottom: none;
    }
    body.dark-mode .settings-menu-item { border-bottom-color: #333; }
    .settings-menu-item:hover { background-color: rgba(0, 0, 0, 0.03); }
    body.dark-mode .settings-menu-item:hover { background-color: rgba(255, 255, 255, 0.05); }
    .settings-menu-item span:first-child { font-weight: 500; }
    .settings-menu-item .arrow { font-size: 1.5rem; font-weight: 400; color: var(--text-light); }
    
    /* --- Style Pengaturan Suara Adzan --- */
    .selection-item-wrapper {
        padding: 0.2rem 0.5rem;
        border-bottom: 1px solid #eee;
        transition: background-color 0.2s ease;
    }
    .selection-item-wrapper:last-child {
        border-bottom: none;
    }
    body.dark-mode .selection-item-wrapper {
        border-bottom-color: #333;
    }
    .selection-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.7rem 0;
        cursor: pointer;
    }
    .selection-item:hover {
        background-color: rgba(0, 0, 0, 0.03);
    }
    body.dark-mode .selection-item:hover {
        background-color: rgba(255, 255, 255, 0.05);
    }
    .selection-item span:first-child { font-weight: 500; }
    .selection-item .checkmark {
        font-size: 1.2rem;
        color: var(--header-bg);
        font-weight: bold;
        visibility: hidden;
    }
    body.dark-mode .selection-item .checkmark { color: var(--accent-color); }
    .selection-item.selected .checkmark { visibility: visible; }

    /* --- Style untuk Volume Control & Tombol Test --- */
    .volume-control-container {
        display: none;
        align-items: center;
        gap: 0.8rem;
        padding: 0.5rem 0 0.8rem 0;
        animation: fadeIn 0.3s ease;
    }
    .volume-control-container.active {
        display: flex;
    }
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(-5px); }
        to { opacity: 1; transform: translateY(0); }
    }
    .volume-control-container .volume-icon {
        font-size: 1.2rem;
        color: var(--text-light);
    }
    .volume-slider {
        -webkit-appearance: none; appearance: none;
        flex-grow: 1; height: 6px;
        background: #ddd; outline: none;
        border-radius: 3px; opacity: 0.9;
        transition: opacity .2s;
    }
    .volume-slider:hover { opacity: 1; }
    .volume-slider::-webkit-slider-thumb {
        -webkit-appearance: none; appearance: none;
        width: 18px; height: 18px;
        background: var(--header-bg); cursor: pointer;
        border-radius: 50%;
    }
    .volume-slider::-moz-range-thumb {
        width: 18px; height: 18px;
        background: var(--header-bg); cursor: pointer;
        border-radius: 50%; border: none;
    }
    .test-sound-btn {
        background: none; border: none;
        font-size: 1.5rem; color: var(--header-bg);
        cursor: pointer; padding: 0.2rem;
        line-height: 1;
    }
    body.dark-mode .volume-slider { background: #444; }
    body.dark-mode .volume-slider::-webkit-slider-thumb { background: var(--accent-color); }
    body.dark-mode .volume-slider::-moz-range-thumb { background: var(--accent-color); }
    body.dark-mode .test-sound-btn { color: var(--accent-color); }
    
    /* CSS UNTUK TOMBOL PLAY STORE */
    .playstore-btn {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        padding: 0.8rem 1rem;
        margin-top: 1.5rem;
        background-color: #000000;
        color: #ffffff;
        border-radius: var(--radius);
        text-decoration: none;
        font-weight: 600;
        font-size: 1rem;
        transition: transform 0.2s ease, background-color 0.2s ease;
    }
    .playstore-btn:active {
        transform: scale(0.97);
    }
    .playstore-btn .playstore-icon {
        width: 24px;
        height: 24px;
    }
    body.dark-mode .playstore-btn {
        background-color: #ffffff;
        color: #000000;
    }


    /* STYLE UNTUK TOMBOL DETAIL APLIKASI */
    .detail-app-container {
      text-align: center;
      padding: 1.5rem 0 0.5rem 0;
    }

    #detail-app-btn {
      background-color: var(--header-bg);
      color: var(--header-text);
      border: none;
      border-radius: var(--radius);
      padding: 0.7rem 1.5rem;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s ease, background-color var(--transition);
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    #detail-app-btn:active {
      transform: scale(0.96);
    }
    
    body.dark-mode #detail-app-btn {
        background-color: var(--tap-area-bg);
        color: var(--text-color);
    }

    /* STYLE UNTUK KONTEN HALAMAN DETAIL */
    .content-body {
        padding: 0 1rem 1.5rem 1rem; 
    }

    .content-card {
        background-color: var(--card-bg);
        border-radius: var(--radius);
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        box-shadow: 0 2px 8px var(--card-shadow);
        transition: background-color var(--transition);
    }

    .content-card p, .content-card li {
        line-height: 1.7; 
        color: var(--text-color);
        opacity: 0.9;
        margin-bottom: 1rem;
    }

    .content-card p:last-child, .content-card li:last-child {
        margin-bottom: 0;
    }

    .content-card strong {
        color: var(--header-bg);
        font-weight: 600;
    }

    body.dark-mode .content-card strong {
        color: var(--accent-color);
    }

    .content-title-icon {
        font-size: 1.5rem;
        margin-right: 0.75rem;
        color: var(--header-bg);
        vertical-align: middle;
    }

    body.dark-mode .content-title-icon {
        color: var(--accent-color);
    }

    h3.content-title {
        display: flex;
        align-items: center;
        font-size: 1.2rem;
        font-weight: 600;
        margin-bottom: 1rem;
        color: var(--text-color);
    }
    
/* TAMBAHKAN BLOK CSS BARU INI */
.surah-audio-player {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 1rem;
    padding: 1rem 0.5rem;
    margin-bottom: 1rem;
    background-color: var(--tap-area-bg);
    border-radius: var(--radius);
}
#surah-play-btn {
    background-color: var(--card-bg);
    border: 1px solid #ddd;
    width: 44px;
    height: 44px;
    border-radius: 50%;
    font-size: 1.5rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--text-color);
    box-shadow: 0 2px 4px var(--card-shadow);
}
body.dark-mode #surah-play-btn {
    border-color: #444;
}

    ul.styled-list {
        list-style: none;
        padding-left: 0;
    }

    ul.styled-list li {
        position: relative;
        padding-left: 1.8rem;
        margin-bottom: 1rem;
    }

    ul.styled-list li::before {
        content: '✓'; 
        position: absolute;
        left: 0;
        top: 2px;
        color: var(--header-bg);
        font-weight: 700;
        font-size: 1.1rem;
    }

    body.dark-mode ul.styled-list li::before {
        color: var(--accent-color);
    }

    .email-link-wrapper {
        text-align: center;
        margin-top: 1.5rem;
    }

    /* --- SURAH VIEW STYLES --- */
    #surah-view, #juz-detail-view { padding-top: 1.5rem; padding-bottom: 2rem; }
    #surah-view .view-header { position: sticky; top: 0; background-color: var(--primary-bg); padding-top: 1.5rem; padding-bottom: 1rem; z-index: 100; transition: background-color var(--transition); }
    #surah-view-body { padding: 0 1rem; }
    .surah-detail-header { text-align: center; margin-bottom: 1.5rem; padding: 1.5rem; background-color: var(--card-bg); border-radius: var(--radius); box-shadow: 0 2px 5px var(--card-shadow); }
    .surah-detail-header h2 { font-size: 1.8rem; font-weight: 600; color: var(--header-bg); margin-bottom: 0.25rem; }
    .surah-detail-header p { font-size: 1rem; color: var(--text-color); margin-bottom: 0.5rem; }
    .surah-detail-header .meta { font-size: 0.8rem; color: var(--text-light); text-transform: uppercase; }
    
    .basmala { text-align: center; padding-bottom: 1.5rem; margin-bottom: 1rem; border-bottom: 1px solid #eee; }
    body.dark-mode .basmala { border-bottom-color: #444; }
    .basmala .basmala-arabic { font-size: 1.8rem; direction: rtl; margin: 0; padding: 0; }
    .basmala .basmala-translation { font-size: 0.9rem; font-style: italic; color: var(--text-light); margin-top: 0.5rem; }
    
    .ayah-item { padding: 1.2rem 0; border-bottom: 1px solid #eee; }
    body.dark-mode .ayah-item { border-bottom-color: #333; }
    .ayah-item:last-child { border-bottom: none; }
    .ayah-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
    .ayah-number { font-weight: 600; background: var(--tap-area-bg); color: var(--text-light); padding: 0.2rem 0.6rem; border-radius: 8px; font-size: 0.9rem; }
    .ayah-arabic { font-size: 1.8rem; text-align: right; direction: rtl; line-height: 2.8rem; margin-bottom: 1rem; }
    .ayah-latin { font-size: 0.95rem; font-style: italic; color: #555; line-height: 1.6rem; margin-bottom: 1rem; }
    .ayah-translation { font-size: 0.9rem; line-height: 1.5rem; }
    body.dark-mode .ayah-latin { color: #ddd; }
    body.dark-mode .ayah-translation { color: #ccc; }
    
    /* --- TAMPILAN KIBLAT --- */
    #qibla-view {
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      box-sizing: border-box;
      background-color: #000000;
      color: #ffffff;
      padding: 1rem;
    }
    #qibla-view .view-header {
      position: absolute;
      top: 0;
      width: 100%;
      color: white;
    }
     #qibla-view .view-header h2, #qibla-view .back-button {
        color: #ffffff;
       }

    #qibla-compass-container {
        position: relative;
        width: 300px;
        height: 300px;
        display: flex;
        justify-content: center;
        align-items: center;
    }
    #qibla-compass-circle {
        width: 100%;
        height: 100%;
        background-color: #F0E68C; /* Khaki - pale yellow */
        border: 5px solid #5C4033; /* Dark brown border */
        border-radius: 50%;
        transition: background-color 0.4s ease;
        position: relative;
    }
    #qibla-compass-circle.aligned {
        background-color: #FFD700; /* Gold */
    }
    
    #qibla-lubber-line {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      width: 4px;
      height: 30px;
      background-color: #FF4500; /* OrangeRed */
      border-radius: 2px;
      z-index: 3;
    }

    #qibla-needle {
        position: absolute;
        width: 4px;
        height: 120px;
        background-color: #333333;
        top: 30px;
        left: 50%;
        transform-origin: bottom center;
        transform: translateX(-50%) rotate(0deg);
        transition: transform 0.2s linear;
        border-radius: 2px;
        z-index: 2;
    }
    
    #qibla-info-box {
      margin-top: 2rem;
      text-align: center;
      max-width: 320px;
    }
    #qibla-info-box .direction-degree {
      font-size: 1.2rem;
      font-weight: 500;
      margin-bottom: 1rem;
    }
    #qibla-info-box .calibration-info {
      font-size: 0.8rem;
      color: #ccc;
      line-height: 1.4;
      margin-bottom: 1rem;
    }
    #qibla-recalibrate-btn {
      background: none;
      border: 1px solid #f9d788;
      color: #f9d788;
      padding: 0.5rem 1rem;
      border-radius: 20px;
      cursor: pointer;
    }

  </style>
</head>
<body>
  <nav id="sidebar">
    <h3 data-key="nav_title">Menu</h3>
    <ul>
      <li><a href="#" id="prayer-times-btn">🕒 Jadwal Sholat</a></li>
      <li><a href="#" id="doa-harian-btn" data-key="nav_doa">🤲 Doa Harian</a></li>
      <li><a href="#" id="quran-btn" data-key="nav_quran">📖 Al-Qur'an</a></li>
      <li><a href="#" id="dzikir-btn" data-key="nav_dzikir">📿 Dzikir & Tasbih</a></li>
      <li><a href="#" id="qibla-btn" data-key="nav_kiblat">🕋 Kiblat</a></li>
      <li><a href="#" id="settings-btn" data-key="nav_settings">⚙️ Pengaturan</a></li>
    </ul>
  </nav>

  <div class="app-container">
    <div id="prayer-times-view" class="main-view">
        <header class="main-header">
          <button id="menu-toggle"><span class="bar"></span><span class="bar"></span><span class="bar"></span></button>
          <h1 id="next-prayer-name">Imsak</h1>
          <p data-key="remaining_time">Waktu Tersisa</p>
          <div id="countdown-timer">00:00:00</div>
          <div id="location-display"><span class="icon">📍</span><span id="city-name">Memuat...</span></div>
        </header>

        <section class="calendar-section">
          <div class="date-header">
            <span class="hijri-date" id="hijri-date-display">...</span>
            <span class="gregorian-date" id="gregorian-date-display">...</span>
          </div>
          <div class="calendar-view" id="calendar-view-container"></div>
        </section>
        <main class="prayer-list-section" id="prayer-list-container"></main>
        <footer class="app-footer">Annur Islamic</footer> 
    </div>

    <div id="doa-view" class="main-view generic-list-view" style="display: none;">
      <div class="view-header">
        <span class="back-button" data-target-view="prayer-times-view">‹</span>
        <h2>Doa Harian</h2>
      </div>
      <div class="last-read-card" id="last-read-doa-card">
        <h3 data-key="last_read">TERAKHIR DIBACA</h3>
        <p data-key="no_last_read">Belum ada doa yang dibaca</p>
      </div>
      <div class="tabs-container">
        <div class="tab-item active" data-tab="all" data-key="all_doa">Semua Doa</div>
        <div class="tab-item" data-tab="bookmarked" data-key="bookmarked">Ditandai</div>
      </div>
      <div class="list-container" id="doa-list-container-view"></div>
    </div>

    <div id="quran-view" class="main-view generic-list-view" style="display: none;">
      <div class="view-header">
        <span class="back-button" data-target-view="prayer-times-view">‹</span>
        <h2>Al-Qur'an</h2>
      </div>
      <div class="last-read-card" id="last-read-surah-card">
        <h3>TERAKHIR DIBACA</h3>
        <p>Belum ada surah yang dibaca</p>
      </div>
      <div class="tabs-container" id="quran-tabs">
        <div class="tab-item active" data-tab="surah">Surah</div>
        <div class="tab-item" data-tab="juz">Juz</div>
        <div class="tab-item" data-tab="bookmarked">Ditandai</div>
      </div>
      <div class="list-container" id="quran-list-container"></div>
    </div>
    
    <div id="juz-detail-view" class="main-view" style="display: none;">
      <div class="view-header">
        <span class="back-button" data-target-view="quran-view">‹</span>
        <h2 id="juz-detail-title">Daftar Surah</h2>
      </div>
      <div class="list-container" id="juz-surah-list-container"></div>
    </div>

    <div id="surah-view" class="main-view" style="display: none;">
      <div class="view-header">
        <span class="back-button" id="surah-view-back-btn">‹</span>
        <h2 id="surah-view-title">Nama Surah</h2>
        <span class="action-icon" id="surah-view-bookmark-btn">⭐</span>
      </div>
      <div id="surah-view-body">
      </div>
    </div>

    <div id="dzikir-view" class="main-view generic-list-view" style="display: none;">
      <div class="view-header">
        <span class="back-button" data-target-view="prayer-times-view">‹</span>
        <h2>Dzikir & Tasbih</h2>
      </div>
      <div class="list-container" id="dzikir-list-container"></div>
    </div>
  </div>

  <div id="qibla-view" class="main-view">
      <div class="view-header">
        <span class="back-button" data-target-view="prayer-times-view">‹</span>
        <h2>Arah Kiblat</h2>
      </div>
      
      <div id="qibla-compass-container">
        <div id="qibla-compass-circle">
          <div id="qibla-lubber-line"></div>
          <div id="qibla-needle"></div>
        </div>
      </div>
      
      <div id="qibla-info-box">
          <p class="direction-degree">Arahkan jarum ke garis merah</p>
          <p class="calibration-info">Jika arah tidak akurat, gerakkan HP membentuk angka 8 & jauhkan dari logam/magnet.</p>
          <button id="qibla-recalibrate-btn">Kalibrasi Ulang</button>
      </div>

      <div id="qibla-permission-prompt" style="display: none; text-align:center; padding: 2rem; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">
          <p style="color:white; margin-bottom: 1rem;">Fitur ini memerlukan izin lokasi dan sensor gerak.</p>
          <button id="qibla-permission-btn" class="modal-action-btn" style="max-width: 200px; margin:auto; background-color: #f9d788; color: #1a3a32;">Mulai</button>
      </div>
  </div>

  <div id="tasbih-view" class="main-view">
      <div class="view-header">
        <span class="back-button" data-target-view="dzikir-view">‹</span>
        <h2 id="tasbih-title">Penghitung Tasbih</h2>
      </div>
      <div class="tasbih-main">
          <div id="tasbih-counter-display">
              <div class="count" id="tasbih-current-count">0</div>
              <div class="target" id="tasbih-target-count">/ 33</div>
          </div>
          <div id="tasbih-text-display">
            <p class="tasbih-arabic"></p>
            <p class="tasbih-latin"></p>
            <p class="tasbih-arti"></p>
          </div>
          <div id="tasbih-tap-area">
              <span class="tap-icon">🖐️</span>
          </div>
          <button id="tasbih-reset-btn">Reset</button>
      </div>
  </div>

  <div id="settings-modal" class="full-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 data-key="settings_title">Pengaturan</h3>
        <span class="close-button">&times;</span>
      </div>
      <div class="modal-body">
        <div class="settings-item">
          <label for="dark-mode-toggle" data-key="settings_dark_mode">Mode Malam</label>
          <label class="switch"><input type="checkbox" id="dark-mode-toggle"><span class="slider"></span></label>
        </div>
        <div class="settings-item">
            <label for="enable-notifications-btn" data-key="settings_notifications">Notifikasi Adzan</label>
            <button id="enable-notifications-btn">Aktifkan</button>
        </div>
        <div class="settings-item">
          <label for="language-select" data-key="settings_language">Bahasa</label>
          <select name="language" id="language-select" class="custom-select">
            <option value="id">Bahasa Indonesia</option>
            <option value="en">English</option>
            <option value="ar">العربية (Arabic)</option>
            <option value="tr">Türkçe (Turkish)</option>
            <option value="fr">Français (French)</option>
            <option value="es">Español (Spanish)</option>
            <option value="de">Deutsch (German)</option>
            <option value="ru">Русский (Russian)</option>
            <option value="ur">اردو (Urdu)</option>
            <option value="bn">বাংলা (Bengali)</option>
          </select>
        </div>
        
        <div class="settings-group" style="margin-top: 1.5rem; padding: 0; background-color: transparent; box-shadow: none;">
            <div id="adhan-settings-trigger-container">
            </div>
        </div>

        <div class="settings-group" style="padding: 1rem; margin-top: 1rem;">
            <h4 style="font-size: 1rem; color: var(--header-bg); margin-bottom: 0.75rem; padding-bottom: 0; border: none;">Notifikasi Terlambat?</h4>
            <p style="font-size: 0.85rem; color: var(--text-light); line-height: 1.5; margin-bottom: 1rem;">
                Beberapa merk HP membatasi aplikasi di latar belakang. Jika notifikasi tidak tepat waktu, coba optimalkan.
            </p>
            <button onclick="Android.requestBatteryOptimization()" class="modal-action-btn" style="width: 100%; margin-top: 0;">
                Optimalkan Notifikasi
            </button>
        </div>
        <div class="settings-group" style="margin-top: 1.5rem; padding-top: 1rem; border-top: 1px solid #ddd;">
            <div class="settings-item">
                <label data-key="settings_about">Tentang Aplikasi</label>
                <span>v18.02.22 (Beta)</span>
            </div>
            <div class="detail-app-container">
                <button id="detail-app-btn">Detail Aplikasi</button>
            </div>
        </div>
      </div>
    </div>
  </div>

  <div id="single-doa-modal" class="full-modal">
    <div class="modal-content">
        <div class="modal-header">
            <span class="close-button">&times;</span>
            <h3 id="single-doa-modal-title">Detail Doa</h3>
            <span class="action-icon" id="bookmark-doa-btn">⭐</span>
        </div>
        <div class="modal-body" id="single-doa-modal-body"></div>
    </div>
  </div>

  <div id="dzikir-detail-modal" class="full-modal">
    <div class="modal-content">
        <div class="modal-header">
            <span class="close-button">&times;</span>
            <h3 id="dzikir-detail-modal-title">Detail Dzikir</h3>
        </div>
        <div class="modal-body" id="dzikir-detail-modal-body"></div>
    </div>
  </div>

  <div id="adhan-settings-view" class="main-view" style="display: none; padding-top: 1.5rem;">
      <div class="view-header">
          <span class="back-button" id="adhan-settings-back-btn">‹</span>
          <h2>Pengaturan Suara Adzan</h2>
      </div>
      <div class="content-body" id="adhan-settings-body">
        </div>
  </div>

  <div id="app-detail-view" class="main-view" style="display: none; padding-top: 1.5rem;">
    <div class="view-header">
      <span class="back-button" id="detail-view-back-btn">‹</span>
      <h2>Detail Aplikasi</h2>
    </div>
    <div class="content-body" style="padding: 0 1.5rem;">
      <div class="settings-menu-item" data-target-view="privacy-policy-view">
        <span>Kebijakan Privasi</span>
        <span class="arrow">&rsaquo;</span>
      </div>
      <div class="settings-menu-item" data-target-view="terms-of-use-view">
        <span>Ketentuan Penggunaan</span>
        <span class="arrow">&rsaquo;</span>
      </div>
      <div class="settings-menu-item" data-target-view="additional-info-view">
        <span>Informasi Tambahan</span>
        <span class="arrow">&rsaquo;</span>
      </div>
       <div class="settings-menu-item" data-target-view="feedback-view">
        <span>Saran & Masukan</span>
        <span class="arrow">&rsaquo;</span>
      </div>
      <div class="settings-item">
        <label>Versi Aplikasi</label>
        <span>v18.02.22 (Beta)</span>
      </div>
      
      <a href="https://play.google.com/store/apps/details?id=com.nama.paket.anda" target="_blank" class="playstore-btn">
          <svg class="playstore-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <path d="M2.57 2.15C2.37 2.27 2.25 2.5 2.25 2.75v18.5c0 .25.12.48.32.6l10.06-10.05L2.57 2.15z" fill="#00c0f3"></path>
              <path d="M14.2 11.25L3.92 21.43c.19.07.4.12.63.12h.02c.26 0 .5-.09.7-.25l3.8-2.61 5.13-5.44z" fill="#4ffab9"></path>
              <path d="M14.2 12.75l-5.13-5.44-3.8-2.61a1.24 1.24 0 0 1-.7-.25h-.02c-.23 0-.44.05-.63.12L14.2 12.75z" fill="#ffda44"></path>
              <path d="M19.7 15.02c.7-.72.7-1.89 0-2.6l-3.32-3.32-2.18 2.31 5.5 3.61z" fill="#ff5555"></path>
              <path d="M14.2 12l-10.1 9.98c.2.12.43.2.68.2a1.2 1.2 0 0 0 .99-.5l12.5-7.18-4.07-4.1z" fill="#ff7043" opacity=".6"></path>
          </svg>
          <span>Unduh di Google PlayStore</span>
      </a>
      
    </div>
  </div>

  <div id="privacy-policy-view" class="main-view" style="display: none; padding-top: 1.5rem;">
      <div class="view-header">
          <span class="back-button" data-target-view="app-detail-view">‹</span>
          <h2>Kebijakan Privasi</h2>
      </div>
      <div class="content-body">
          <div class="content-card">
              <p><strong>Pembaruan Terakhir: 12 Juli 2025</strong></p>
              <p>Aplikasi <strong>Annur Islamic</strong> ("kami") berkomitmen untuk melindungi privasi Anda. Kebijakan ini menjelaskan bagaimana kami mengumpulkan, menggunakan, dan melindungi informasi Anda.</p>
          </div>

          <div class="content-card">
              <h3 class="content-title"><span class="content-title-icon">📍</span>Pengumpulan Informasi Lokasi</h3>
              <p>Aplikasi ini mengumpulkan data lokasi geografis Anda (latitude dan longitude) hanya untuk tujuan menghitung waktu sholat yang akurat dan menentukan arah Kiblat. Data ini <strong>tidak pernah disimpan</strong> di server kami atau dibagikan dengan pihak ketiga. Semua perhitungan dilakukan secara lokal di perangkat Anda.</p>
          </div>

          <div class="content-card">
              <h3 class="content-title"><span class="content-title-icon">💾</span>Penyimpanan Lokal</h3>
              <p>Kami menggunakan penyimpanan lokal (localStorage) di browser Anda untuk menyimpan preferensi seperti tema (mode malam), bahasa, pengaturan suara azan, dan data cache jadwal sholat untuk penggunaan offline. Data ini sepenuhnya tetap berada di perangkat Anda dan tidak dikirim ke mana pun.</p>
          </div>
      </div>
  </div>

  <div id="terms-of-use-view" class="main-view" style="display: none; padding-top: 1.5rem;">
      <div class="view-header">
          <span class="back-button" data-target-view="app-detail-view">‹</span>
          <h2>Ketentuan Penggunaan</h2>
      </div>
      <div class="content-body">
          <div class="content-card">
              <p>Dengan mengunduh atau menggunakan aplikasi Annur Islamic, Anda secara otomatis menyetujui ketentuan berikut:</p>
              <ul class="styled-list">
                  <li>Anda tidak diizinkan untuk menyalin, memodifikasi aplikasi, atau merek dagang kami dengan cara apa pun.</li>
                  <li>Aplikasi ini disediakan "sebagaimana adanya". Kami berusaha memastikan keakuratan data, namun tidak memberikan jaminan mutlak. Pengguna disarankan untuk verifikasi silang dengan sumber tepercaya.</li>
                  <li>Kami berhak untuk mengubah ketentuan ini kapan saja. Penggunaan aplikasi secara berkelanjutan dianggap sebagai penerimaan Anda terhadap ketentuan baru.</li>
              </ul>
          </div>
      </div>
  </div>

  <div id="additional-info-view" class="main-view" style="display: none; padding-top: 1.5rem;">
      <div class="view-header">
          <span class="back-button" data-target-view="app-detail-view">‹</span>
          <h2>Informasi Tambahan</h2>
      </div>
      <div class="content-body">
          <div class="content-card">
              <h3 class="content-title"><span class="content-title-icon">📊</span>Sumber Data</h3>
              <ul class="styled-list">
                  <li><strong>Waktu Sholat:</strong> Menggunakan API dari Aladhan.com dengan metode kalkulasi ISNA.</li>
                  <li><strong>Al-Qur'an:</strong> Teks, terjemahan, dan data surah diambil dari API publik Quran.gading.dev.</li>
                  <li><strong>Arah Kiblat:</strong> Dihitung menggunakan koordinat geografis dan data sensor perangkat.</li>
                  <li><strong>Lokasi:</strong> Nama kota didapatkan melalui layanan Nominatim (OpenStreetMap).</li>
              </ul>
          </div>
          <div class="content-card">
              <h3 class="content-title"><span class="content-title-icon">❤️</span>Proyek Non-Komersial</h3>
              <p>Aplikasi ini adalah proyek non-komersial, dibuat untuk membantu umat Muslim dalam ibadah sehari-hari. Aplikasi ini sepenuhnya <strong>gratis dan tidak mengandung iklan</strong>.</p>
          </div>
      </div>
  </div>

  <div id="feedback-view" class="main-view" style="display: none; padding-top: 1.5rem;">
      <div class="view-header">
          <span class="back-button" data-target-view="app-detail-view">‹</span>
          <h2>Saran & Masukan</h2>
      </div>
      <div class="content-body">
          <div class="content-card">
              <h3 class="content-title"><span class="content-title-icon">💌</span>Hubungi Kami</h3>
              <p>Kami sangat menghargai saran dan masukan dari Anda untuk membuat aplikasi ini menjadi lebih baik. Silakan kirimkan ide, laporan bug, atau masukan lainnya melalui email kepada pengembang.</p>
              <div class="email-link-wrapper">
                  <a href="mailto:annuislamic60@gmail.com?subject=Masukan untuk Aplikasi Annur Islamic" class="modal-action-btn" style="text-decoration: none; display: inline-block; width: auto; padding: 0.8rem 1.5rem;">Kirim Email</a>
              </div>
          </div>
      </div>
  </div>
  
  <div id="custom-location-modal" class="full-modal">
    <div class="modal-content permission-modal-content">
      <h3>Butuh Izin Lokasi Anda</h3>
      <p>Aplikasi ini memerlukan akses ke lokasi Anda untuk menampilkan jadwal sholat dan arah kiblat yang akurat. Data lokasi Anda tidak disimpan atau dibagikan.</p>
      <div class="permission-modal-actions">
        <button id="deny-location-btn" class="modal-action-btn deny-btn" style="margin-top: 0;">Nanti Saja</button>
        <button id="allow-location-btn" class="modal-action-btn" style="margin-top: 0;">Izinkan</button>
      </div>
    </div>
  </div>

  <div id="custom-notification-modal" class="full-modal">
    <div class="modal-content permission-modal-content">
      <h3>Aktifkan Notifikasi Adzan?</h3>
      <p>Izinkan aplikasi mengirimkan notifikasi agar Anda tidak ketinggalan waktu sholat. Anda dapat mengatur suara dan jadwal notifikasi di menu Pengaturan.</p>
      <div class="permission-modal-actions">
        <button id="deny-notification-btn" class="modal-action-btn deny-btn" style="margin-top: 0;">Lain Kali</button>
        <button id="allow-notification-btn" class="modal-action-btn" style="margin-top: 0;">Aktifkan</button>
      </div>
    </div>
  </div>

  <audio id="audio-notification" src="https://raw.githubusercontent.com/AnnurIslamic/Mp3/main/notifikasi.mp3" preload="auto"></audio>
  <audio id="audio-adhan-fajr" src="https://raw.githubusercontent.com/AnnurIslamic/Mp3/main/adzansubuh.mp3" preload="auto"></audio>
  <audio id="audio-adhan-mishary" src="https://raw.githubusercontent.com/AnnurIslamic/Mp3/main/mishary.mp3" preload="auto"></audio>
  <audio id="audio-adhan-madinah" src="https://raw.githubusercontent.com/AnnurIslamic/Mp3/main/adzankota.mp3" preload="auto"></audio>
<audio id="murottal-player" preload="auto"></audio>

  
<script>
// --- DATA ---
const dzikirData = [
  { id: 'dzikir_1', title: 'Tasbih', subtitle: 'Menyucikan Allah', arabic: 'سُبْحَانَ اللَّهِ', latin: 'Subhanallah', arti: 'Maha Suci Allah', target: 33 },
  { id: 'dzikir_2', title: 'Tahmid', subtitle: 'Memuji Allah', arabic: 'الْحَمْدُ لِلَّهِ', latin: 'Alhamdulillah', arti: 'Segala Puji Bagi Allah', target: 33 },
  { id: 'dzikir_3', title: 'Takbir', subtitle: 'Mengagungkan Allah', arabic: 'اللَّهُ أَكْبَرُ', latin: 'Allahu Akbar', arti: 'Allah Maha Besar', target: 33 },
  { id: 'dzikir_4', title: 'Tahlil', subtitle: 'Kalimat Tauhid', arabic: 'لَا إِلَهَ إِلَّا اللَّهُ', latin: 'La ilaha illallah', arti: 'Tiada Tuhan selain Allah', target: 33 },
  { id: 'dzikir_5', title: 'Istighfar', subtitle: 'Memohon Ampunan', arabic: 'أَسْتَغْفِرُ اللَّهَ', latin: 'Astaghfirullah', arti: 'Aku memohon ampun kepada Allah', target: 33 },
  { id: 'dzikir_6', title: 'Salawat Nabi', subtitle: 'Untuk Nabi Muhammad SAW', arabic: 'اللَّهُمَّ صَلِّ عَلَى مُحَمَّدٍ وَعَلَى آلِ مُحَمَّدٍ', latin: 'Allahumma salli \'ala Muhammad wa \'ala ali Muhammad', arti: 'Ya Allah, berikanlah rahmat kepada Nabi Muhammad dan keluarga Nabi Muhammad.', target: 33 },
  { id: 'dzikir_7', title: 'Hauqalah', subtitle: 'Pengakuan Kekuatan Allah', arabic: 'لَا حَوْلَ وَلَا قُوَّةَ إِلَّا بِاللهِ', latin: 'La hawla wa la quwwata illa billah', arti: 'Tiada daya dan upaya kecuali dengan kekuatan Allah.', target: 33 }
];
const doaHarianData = [
    { id: 1, title: "Doa Bangun Tidur", subtitle: "Adab memulai hari", arabic: "الْحَمْدُ لِلَّهِ الَّذِي أَحْيَانَا بَعْدَ مَا أَمَاتَنَا وَإِلَيْهِ النُّشُورُ", latin: "Alhamdulillahilladzi ahyaanaa ba'da maa amaatanaa wa ilaihin nusyuur", arti: "Segala puji bagi Allah yang telah menghidupkan kami setelah mematikan kami, dan kepada-Nya lah kami akan dibangkitkan." },
    { id: 2, title: "Doa Masuk Toilet", subtitle: "Memohon perlindungan", arabic: "اللَّهُمَّ إِنِّي أَعُوذُ بِكَ مِنَ الْخُبُثِ وَالْخَبَائِثِ", latin: "Allahumma innii a'uudzubika minal khubutsi wal khabaaitsi", arti: "Ya Allah, sesungguhnya aku berlindung kepada-Mu dari setan laki-laki dan setan perempuan." },
    { id: 3, title: "Doa Keluar Toilet", subtitle: "Memohon ampunan", arabic: "غُفْرَانَكَ", latin: "Ghufraanaka", arti: "Aku memohon ampunan-Mu." },
    { id: 4, title: "Doa Sebelum Wudhu", subtitle: "Niat bersuci", arabic: "بِسْمِ اللَّهِ", latin: "Bismillah", arti: "Dengan menyebut nama Allah." },
    { id: 5, title: "Doa Setelah Wudhu", subtitle: "Menyempurnakan wudhu", arabic: "أَشْهَدُ أَنْ لاَ إِلَهَ إِلاَّ اللَّهُ وَحْدَهُ لاَ شَرِيكَ لَهُ وَأَشْهَدُ أَنَّ مُحَمَّدًا عَبْدُهُ وَرَسُولُهُ", latin: "Asyhadu an laa ilaaha illallaah wahdahu laa syariika lah, wa asyhadu anna muhammadan 'abduhu wa rasuuluh", arti: "Aku bersaksi bahwa tiada Tuhan selain Allah semata, tiada sekutu bagi-Nya, dan aku bersaksi bahwa Muhammad adalah hamba dan utusan-Nya." },
    { id: 6, title: "Doa Mengenakan Pakaian", subtitle: "Mensyukuri nikmat", arabic: "الْحَمْدُ لِلَّهِ الَّذِي كَسَانِي هَذَا وَرَزَقَنِيهِ مِنْ غَيْرِ حَوْلٍ مِنِّي وَلاَ قُوَّةٍ", latin: "Alhamdulillahilladzi kasaanii hadzaa wa razaqaniihi min ghairi haulin minnii wa laa quwwatin", arti: "Segala puji bagi Allah yang telah memberiku pakaian ini dan menganugerahkannya kepadaku tanpa daya dan kekuatan dariku." },
    { id: 7, title: "Doa Melepas Pakaian", subtitle: "Adab melepas pakaian", arabic: "بِسْمِ اللَّهِ", latin: "Bismillah", arti: "Dengan menyebut nama Allah." },
    { id: 8, title: "Doa Keluar Rumah", subtitle: "Memohon perlindungan", arabic: "بِسْمِ اللَّهِ تَوَكَّلْتُ عَلَى اللَّهِ لاَ حَوْلَ وَلاَ قُوَّةَ إِلاَّ بِاللَّهِ", latin: "Bismillahi tawakkaltu 'alallah, laa haula wa laa quwwata illaa billaah", arti: "Dengan nama Allah, aku bertawakal kepada Allah, tiada daya dan kekuatan kecuali dengan pertolongan Allah." },
    { id: 9, title: "Doa Masuk Rumah", subtitle: "Memohon kebaikan", arabic: "بِسْمِ اللَّهِ وَلَجْنَا وَبِسْمِ اللَّهِ خَرَجْنَا وَعَلَى رَبِّنَا تَوَكَّلْنَا", latin: "Bismillahi walajnaa wa bismillahi kharajnaa wa 'alaa rabbinaa tawakkalnaa", arti: "Dengan nama Allah kami masuk, dan dengan nama Allah kami keluar, dan kepada Tuhan kami, kami bertawakal." },
    { id: 10, title: "Doa Pergi ke Masjid", subtitle: "Langkah menuju kebaikan", arabic: "اللَّهُمَّ اجْعَلْ فِي قَلْبِي نُورًا وَفِي لِسَانِي نُورًا...", latin: "Allahummaj 'al fii qalbii nuuran wa fii lisaanii nuuran...", arti: "Ya Allah, jadikanlah cahaya di hatiku, cahaya di lidahku..." },
    { id: 11, title: "Doa Masuk Masjid", subtitle: "Memohon rahmat", arabic: "اللَّهُمَّ افْتَحْ لِي أَبْوَابَ رَحْمَتِكَ", latin: "Allahummaftah lii abwaaba rahmatika", arti: "Ya Allah, bukakanlah untukku pintu-pintu rahmat-Mu." },
    { id: 12, title: "Doa Keluar Masjid", subtitle: "Memohon karunia", arabic: "اللَّهُمَّ إِنِّي أَsْأَلُكَ مِنْ فَضْلِكَ", latin: "Allahumma innii as'aluka min fadhlik", arti: "Ya Allah, sesungguhnya aku memohon kepada-Mu dari karunia-Mu." },
    { id: 13, title: "Doa Sebelum Makan", subtitle: "Agar makanan berkah", arabic: "بِسْمِ اللَّهِ", latin: "Bismillah", arti: "Dengan menyebut nama Allah." },
    { id: 14, title: "Doa Sesudah Makan", subtitle: "Tanda bersyukur", arabic: "الْحَمْدُ لِلَّهِ الَّذِي أَطْعَمَنِي هَذَا وَرَZَقَنِيهِ مِنْ غَيْرِ حَوْلٍ مِنِّي وَلاَ قُوَّةٍ", latin: "Alhamdulillahilladzi ath'amanii hadzaa wa razaqaniihi min ghairi haulin minnii wa laa quwwatin", arti: "Segala puji bagi Allah yang telah memberiku makanan ini dan menganugerahkannya kepadaku tanpa daya dan kekuatan dariku." },
    { id: 15, title: "Doa Ketika Lupa Basmalah", subtitle: "Jika lupa di awal", arabic: "بِسْمِ اللَّهِ أَوَّلَهُ وَآخِرَهُ", latin: "Bismillahi awwalahu wa aakhirahu", arti: "Dengan nama Allah di awal dan di akhirnya." },
    { id: 16, title: "Doa Minum Air Zamzam", subtitle: "Memohon kebaikan", arabic: "اللَّهُمَّ إِنِّي أَسْأَلُكَ عِلْمًا نَافِعًا وَرِزْقًا وَاسِعًا وَشِفَاءً مِنْ كُلِّ دَاءٍ", latin: "Allahumma innii as'aluka 'ilman naafi'an, wa rizqan waasi'an, wasyifaa'an min kulli daa'in", arti: "Ya Allah, aku memohon kepada-Mu ilmu yang bermanfaat, rezeki yang luas, dan kesembuhan dari segala penyakit." },
    { id: 17, title: "Doa Berbuka Puasa", subtitle: "Saat berbuka puasa", arabic: "ذَهَبَ الظَّمَأُ وَابْتَلَّتِ الْعُرُوقُ وَثَبَتَ الأَجْرُ إِنْ شَاءَ اللَّهُ", latin: "Dzahabazh zhoma'u wabtallatil 'uruuqu wa tsabatal ajru insyaallah", arti: "Telah hilang dahaga, telah basah urat-urat, dan telah tetap pahala, insya Allah." },
    { id: 18, title: "Doa Sebelum Tidur", subtitle: "Adab mengakhiri hari", arabic: "بِاسْمِكَ اللَّهُمَّ أَمُوتُ وَأَحْيَا", latin: "Bismikallahumma amuutu wa ahyaa", arti: "Dengan nama-Mu ya Allah aku mati dan aku hidup." },
    { id: 19, title: "Doa Ketika Mimpi Buruk", subtitle: "Memohon perlindungan", arabic: "أَعُوذُ بِكَلِمَاتِ اللَّهِ التَّامَّاتِ مِنْ غَضَبِهِ وَعِقَابِهِ وَشَرِّ عِبَادِهِ...", latin: "A'uudzu bikalimaatillaahit taammaati min ghadhabihi wa 'iqaabihi wa syarri 'ibaadihi...", arti: "Aku berlindung dengan kalimat-kalimat Allah yang sempurna dari kemurkaan-Nya, siksa-Nya, dan kejahatan hamba-hamba-Nya..." },
    { id: 20, title: "Doa Naik Kendaraan", subtitle: "Memohon keselamatan", arabic: "سُبْحَانَ الَّذِي سَخَّرَ لَنَا هَذَا وَمَا كُنَّا لَهُ مُقْرِنِينَ", latin: "Subhaanalladzii sakhkhara lanaa hadzaa wa maa kunnaa lahu muqriniin", arti: "Maha Suci Dzat yang telah menundukkan semua ini bagi kami padahal kami sebelumnya tidak mampu menguasainya." },
    { id: 21, title: "Doa Safar (Bepergian)", subtitle: "Memohon kemudahan", arabic: "اللَّهُمَّ هَوِّنْ عَلَيْنَا سَفَرَنَا هَذَا وَاطْوِ عَنَّا بُعْدَهُ", latin: "Allahumma hawwin 'alainaa safaranaa hadzaa waathwi 'annaa bu'dahu", arti: "Ya Allah, mudahkanlah perjalanan kami ini, dan dekatkanlah jaraknya bagi kami." },
    { id: 22, title: "Doa Tiba di Tujuan", subtitle: "Rasa syukur", arabic: "الْحَمْدُ لِلَّهِ الَّذِي سَلَّمَنِي", latin: "Alhamdulillahilladzi sallamanii", arti: "Segala puji bagi Allah yang telah menyelamatkanku." },
    { id: 23, title: "Doa Menjenguk Orang Sakit", subtitle: "Mendoakan kesembuhan", arabic: "لاَ بَأْسَ طَهُورٌ إِنْ شَاءَ اللَّهُ", latin: "Laa ba'sa thahuurun insyaallah", arti: "Tidak mengapa, semoga menjadi pembersih (dosa), insya Allah." },
    { id: 24, title: "Doa Ketika Hujan Turun", subtitle: "Memohon hujan bermanfaat", arabic: "اللَّهُمَّ صَيِّبًا نَافِعًا", latin: "Allahumma shayyiban naafi'an", arti: "Ya Allah, (jadikanlah hujan ini) hujan yang bermanfaat." },
    { id: 25, title: "Doa Setelah Hujan", subtitle: "Rahmat dari Allah", arabic: "مُطِرْنَا بِفَضْلِ اللَّهِ وَرَحْمَتِهِ", latin: "Muthirnaa bifadhlillahi wa rahmatihi", arti: "Kita diberi hujan karena karunia dan rahmat Allah." },
    { id: 26, title: "Doa Melihat Petir", subtitle: "Tanda kebesaran Allah", arabic: "سُبْحَانَ الَّذِي يُسَبِّحُ الرَّعْدُ بِحَمْدِهِ وَالْمَلاَئِكَةُ مِنْ خِيفَتِهِ", latin: "Subhaanalladzii yusabbihur ra'du bihamdihi wal malaa-ikatu min khiifatihi", arti: "Maha Suci Dzat yang petir bertasbih dengan memuji-Nya, dan para malaikat pun (bertasbih) karena takut kepada-Nya." },
    { id: 27, title: "Doa Ketika Angin Kencang", subtitle: "Memohon kebaikan", arabic: "اللَّهُمَّ إِنِّي أَسْأَلُكَ خَيْرَهَا وَأَعُوذُ بِكَ مِنْ شَرِّهَا", latin: "Allahumma innii as'aluka khairahaa wa a'uudzu bika min syarrihaa", arti: "Ya Allah, aku memohon kepada-Mu kebaikannya dan aku berlindung kepada-Mu dari keburukannya." },
    { id: 28, title: "Doa Bercermin", subtitle: "Agar akhlak baik", arabic: "اللَّهُمَّ كَمَا حَسَّنْتَ خَلْقِي فَحَسِّنْ خُلُقِي", latin: "Allahumma kamaa hassanta khalqii fahassin khuluqii", arti: "Ya Allah, sebagaimana Engkau telah memperindah rupaku, maka perindahlah akhlakku." },
    { id: 29, title: "Doa untuk Kedua Orang Tua", subtitle: "Tanda bakti", arabic: "رَبِّ اغْفِرْ لِي وَلِوَالِدَيَّ وَارْحَمْهُمَا كَمَا رَبَّيَانِي صَغِيرًا", latin: "Rabbighfirlii wa liwaalidayya warhamhumaa kamaa rabbayaanii shaghiiran", arti: "Wahai Tuhanku, ampunilah aku dan kedua orang tuaku, dan sayangilah mereka sebagaimana mereka telah menyayangiku di waktu kecil." },
    { id: 30, title: "Doa Kebaikan Dunia Akhirat", subtitle: "Doa sapu jagat", arabic: "رَبَّنَا آتِنَا فِي الدُّنْيَا حَسَنَةً وَفِي الآخِرَةِ حَسَنَةً وَقِنَا عَذَابَ النَّارِ", latin: "Rabbanaa aatinaa fiddunyaa hasanatan wa fil aakhirati hasanatan wa qinaa 'adzaabannaar", arti: "Ya Tuhan kami, berilah kami kebaikan di dunia dan kebaikan di akhirat, dan peliharalah kami dari siksa neraka." },
    { id: 31, title: "Doa Sebelum Belajar", subtitle: "Memohon ilmu", arabic: "رَبِّ زِدْنِي عِلْمًا", latin: "Rabbi zidnii 'ilman", arti: "Wahai Tuhanku, tambahkanlah ilmu kepadaku." },
    { id: 32, title: "Doa Sesudah Belajar", subtitle: "Agar ilmu bermanfaat", arabic: "اللَّهُمَّ انْفَعْنِي بِمَا عَلَّمْتَنِي وَعَلِّمْنِي مَا يَنْفَعُنِي وَزِدْنِي عِلْمًا", latin: "Allahummanfa'nii bimaa 'allamtanii wa 'allimnii maa yanfa'unii wa zidnii 'ilman", arti: "Ya Allah, berilah manfaat atas apa yang telah Engkau ajarkan kepadaku, ajarilah aku apa yang bermanfaat bagiku, dan tambahkanlah ilmu kepadaku." },
    { id: 33, title: "Doa Penutup Majelis", subtitle: "Kaffaratul Majlis", arabic: "سُبْحَانَكَ اللَّهُمَّ وَبِحَمْدِكَ أَشْهَدُ أَنْ لاَ إِلَهَ إِلاَّ أَنْتَ أَسْتَغْفِرُكَ وَأَتُوبُ إِلَيْكَ", latin: "Subhaanakallahumma wa bihamdika, asyhadu an laa ilaaha illaa anta, astaghfiruka wa atuubu ilaika", arti: "Maha Suci Engkau ya Allah, dan dengan memuji-Mu, aku bersaksi bahwa tiada Tuhan selain Engkau, aku memohon ampun dan bertaubat kepada-Mu." },
    { id: 34, title: "Doa Ketika Bersin", subtitle: "Mengucap syukur", arabic: "الْحَمْدُ لِلَّهِ", latin: "Alhamdulillah", arti: "Segala puji bagi Allah." },
    { id: 35, title: "Jawaban Ketika Orang Bersin", subtitle: "Mendoakan saudara", arabic: "يَرْحَمُكَ اللَّهُ", latin: "Yarhamukallah", arti: "Semoga Allah merahmatimu." },
    { id: 36, title: "Doa Ketika Marah", subtitle: "Meredam amarah", arabic: "أَعُوذُ بِاللَّهِ مِنَ الشَّيْطَانِ الرَّجِيمِ", latin: "A'uudzubillaahi minasy syaithaanir rajiim", arti: "Aku berlindung kepada Allah dari setan yang terkutuk." },
    { id: 37, title: "Doa Masuk Pasar", subtitle: "Memohon kebaikan pasar", arabic: "لاَ إِلَهَ إِلاَّ اللَّهُ وَحْدَهُ لاَ شَرِيكَ لَهُ...", latin: "Laa ilaaha illallaah wahdahu laa syariika lah...", arti: "Tiada Tuhan selain Allah semata, tiada sekutu bagi-Nya..." },
    { id: 38, title: "Doa Ketika Tertimpa Musibah", subtitle: "Kalimat istirja'", arabic: "إِنَّا لِلَّهِ وَإِنَّا إِلَيْهِ رَاجِعُونَ", latin: "Innaa lillaahi wa innaa ilaihi raaji'uun", arti: "Sesungguhnya kami milik Allah dan kepada-Nya lah kami akan kembali." },
    { id: 39, title: "Doa untuk Pengantin Baru", subtitle: "Mendoakan keberkahan", arabic: "بَارَكَ اللَّهُ لَكَ وَبَارَكَ عَلَيْكَ وَجَمَعَ بَيْنَكُمَا فِي خَيْرٍ", latin: "Baarakallahu laka wa baaraka 'alaika wa jama'a bainakumaa fii khairin", arti: "Semoga Allah memberkahimu, dan memberkahi atasmu, dan mengumpulkan kalian berdua dalam kebaikan." },
    { id: 40, title: "Doa Ziarah Kubur", subtitle: "Salam kepada ahli kubur", arabic: "السَّلاَمُ عَلَى أَهْلِ الدِّيَارِ مِنَ الْمُؤْمِنِينَ وَالْمُSْلِمِينَ...", latin: "Assalaamu 'ala ahlid diyaari minal mu'miniina wal muslimiin...", arti: "Keselamatan atas penghuni kubur dari kaum mukminin dan muslimin..." },
    { id: 41, title: "Doa Melihat Hilal", subtitle: "Menyambut bulan baru", arabic: "اللَّهُ أَكْبَرُ، اللَّهُمَّ أَهِلَّهُ عَلَيْنَا بِالْYُمْنِ وَالإِيمَانِ وَالسَّلاَمَةِ وَالإِسْلاَمِ", latin: "Allahu Akbar, Allahumma ahillahu 'alainaa bil yumni wal iimaani wassalaamati wal islaam", arti: "Allah Maha Besar, ya Allah, tampakkanlah bulan itu kepada kami dengan membawa keberkahan dan keimanan, keselamatan dan Islam." },
    { id: 42, title: "Doa Agar Diberi Kesabaran", subtitle: "Memohon keteguhan", arabic: "رَبَّنَا أَفْرِغْ عَلَيْنَا صَبْرًا وَثَبِّتْ أَقْدَامَنَا", latin: "Rabbanaa afrigh 'alainaa shabran wa tsabbit aqdaamanaa", arti: "Ya Tuhan kami, limpahkanlah kesabaran kepada kami dan kukuhkanlah pendirian kami." },
    { id: 43, title: "Doa Mohon Petunjuk", subtitle: "Meminta bimbingan", arabic: "اللَّهُمَّ إِنِّي أَسْأَلُكَ الْهُدَى وَالتُّقَى وَالْعَفَافَ وَالْGِنَى", latin: "Allahumma innii as'alukal hudaa wattuqaa wal 'afaafa wal ghinaa", arti: "Ya Allah, aku memohon kepada-Mu petunjuk, ketakwaan, kesucian diri, dan kecukupan." },
    { id: 44, title: "Doa Terhindar dari Sifat Malas", subtitle: "Memohon semangat", arabic: "اللَّهُمَّ إِنِّي أَعُوذُ بِكَ مِنَ الْعَجْزِ وَالْكَسَلِ", latin: "Allahumma innii a'uudzubika minal 'ajzi wal kasali", arti: "Ya Allah, aku berlindung kepada-Mu dari kelemahan dan kemalasan." },
    { id: 45, title: "Doa Agar Diteguhkan Hati", subtitle: "Istiqamah dalam iman", arabic: "يَا مُقَلِّبَ الْقُلُوبِ ثَبِّتْ قَلْبِي عَلَى dِينِكَ", latin: "Yaa muqallibal quluub, tsabbit qalbii 'alaa diinik", arti: "Wahai Dzat yang membolak-balikkan hati, teguhkanlah hatiku di atas agama-Mu." },
    { id: 46, title: "Doa Memohon Ampunan & Rahmat", subtitle: "Permohonan ampunan", arabic: "رَبَّنَا ظَلَمْنَا أَنْفُSَنَا وَإِنْ لَمْ تَغْفِرْ لَنَا وَتَرْحَمْنَا لَنَكُونَنَّ مِنَ الْخَاسِرِينَ", latin: "Rabbanaa zhalamnaa anfusanaa wa illam taghfirlanaa wa tarhamnaa lanakuunanna minal khaasiriin", arti: "Ya Tuhan kami, kami telah menzalimi diri kami sendiri, dan jika Engkau tidak mengampuni kami dan memberi rahmat kepada kami, niscaya kami termasuk orang-orang yang rugi." },
    { id: 47, title: "Doa Saat Sulit Tidur", subtitle: "Agar tidur nyenyak", arabic: "اللَّهُمَّ غَارَتِ النُّجُومُ وَهَدَأَتِ الْعُيُونُ...", latin: "Allahumma ghaaratinnujuumu wa hada'atil 'uyuun...", arti: "Ya Allah, bintang-bintang telah terbenam, mata-mata telah terpejam..." },
    { id: 48, title: "Doa Ketika Memulai Pekerjaan", subtitle: "Memohon kelancaran", arabic: "اللَّهُمَّ إِنِّي أَSْأَلُكَ مِنْ خَيْرِ هَذَا الْعَمَلِ وَخَيْرِ مَا فِيهِ", latin: "Allahumma innii as'aluka min khairi hadzal 'amali wa khairi maa fiihi", arti: "Ya Allah, aku memohon kepada-Mu kebaikan pekerjaan ini dan kebaikan yang ada di dalamnya." },
    { id: 49, title: "Doa Setelah Selesai Bekerja", subtitle: "Rasa syukur", arabic: "الْحَمْدُ لِلَّهِ الَّذِي بِنِعْمَتِهِ تَتِمُّ الصَّالِحَاتُ", latin: "Alhamdulillahilladzi bini'matihi tatimmush shaalihaat", arti: "Segala puji bagi Allah yang dengan nikmat-Nya sempurnalah segala kebaikan." },
    { id: 50, title: "Doa Ketika Mendengar Kabar Baik", subtitle: "Ekspresi kebahagiaan", arabic: "الْحَمْدُ لِلَّهِ الَّذِي بِنِعْمَتِهِ تَتِمُّ الصَّالِحَاتُ", latin: "Alhamdulillahilladzi bini'matihi tatimmush shaalihaat", arti: "Segala puji bagi Allah yang dengan nikmat-Nya sempurnalah segala kebaikan." },
    { id: 51, title: "Doa Ketika Mendengar Kabar Buruk", subtitle: "Menjaga kesabaran", arabic: "الْحَمْدُ لِلَّهِ عَلَى كُلِّ حَالٍ", latin: "Alhamdulillahi 'alaa kulli haal", arti: "Segala puji bagi Allah atas segala keadaan." },
    { id: 52, "title": "Doa Memohon Jodoh Terbaik", "subtitle": "Bagi yang belum menikah", "arabic": "رَبِّ لاَ تَذَرْنِي فَرْدًا وَأَنْتَ خَيْرُ الْوَارِثِينَ", "latin": "Rabbi laa tadzarnii fardan wa anta khairul waaritsiin", "arti": "Ya Tuhanku, janganlah Engkau biarkan aku hidup seorang diri, dan Engkaulah pewaris yang paling baik." },
    { id: 53, "title": "Doa Mohon Keturunan yang Baik", "subtitle": "Doa Nabi Zakaria", "arabic": "رَبِّ هَبْ لِي مِنْ لَدُنْكَ ذُرِّيَّةً طَيِّبَةً إِنَّكَ سَمِيعُ الدُّعَاءِ", "latin": "Rabbi hablii min ladunka dzurriyyatan thayyibatan innaka samii'ud du'aa", "arti": "Ya Tuhanku, berilah aku dari sisi-Mu seorang anak yang baik. Sesungguhnya Engkau Maha Pendengar doa." },
    { id: 54, "title": "Doa Agar Terhindar dari Utang", "subtitle": "Memohon kecukupan", "arabic": "اللَّهُمَّ اكْفِنِي بِحَلاَلِكَ عَنْ حَرَامِكَ وَأَغْنِنِي بِفَضْلِكَ عَمَّنْ سِوَاكَ", "latin": "Allahummak finii bihalaalika 'an haraamika wa aghninii bifadhlika 'amman siwaak", "arti": "Ya Allah, cukupkanlah aku dengan yang halal dan jauhkanlah aku dari yang haram, dan cukupkanlah aku dengan karunia-Mu dari bergantung pada selain-Mu." }
];
const translations = {
    'id': { 'nav_title': 'Menu Navigasi', 'nav_doa': '🤲 Doa Harian', 'nav_quran': '📖 Al-Qur\'an', 'nav_dzikir': '📿 Dzikir & Tasbih', 'nav_kiblat': '🕋 Kiblat', 'nav_settings': '⚙️ Pengaturan', 'remaining_time': 'Waktu Tersisa', 'settings_title': 'Pengaturan', 'settings_dark_mode': 'Mode Malam', 'settings_notifications': 'Notifikasi Adzan', 'settings_language': 'Bahasa', 'settings_about': 'Tentang Aplikasi', 'settings_adhan_sound': 'Pengaturan Suara Adzan', 'last_read': 'TERAKHIR DIBACA', 'no_last_read': 'Belum ada doa yang dibaca', 'all_doa': 'Semua Doa', 'bookmarked': 'Ditandai', 'Imsak': 'Imsak', 'Fajr': 'Subuh', 'Sunrise': 'Terbit', 'Dhuhr': 'Dzuhur', 'Asr': 'Ashar', 'Maghrib': 'Maghrib', 'Isha': 'Isya'},
    'en': { 'nav_title': 'Navigation Menu', 'nav_doa': '🤲 Daily Prayers', 'nav_quran': '📖 Al-Qur\'an', 'nav_dzikir': '📿 Dhikr & Tasbih', 'nav_kiblat': '🧭 Qibla', 'nav_settings': '⚙️ Settings', 'remaining_time': 'Time Remaining', 'settings_title': 'Settings', 'settings_dark_mode': 'Dark Mode', 'settings_notifications': 'Adhan Notifications', 'settings_language': 'Language', 'settings_about': 'About App', 'settings_adhan_sound': 'Adhan Sound Settings', 'last_read': 'LAST READ', 'no_last_read': 'No prayers have been read yet', 'all_doa': 'All Prayers', 'bookmarked': 'Bookmarked', 'Imsak': 'Imsak', 'Fajr': 'Fajr', 'Sunrise': 'Sunrise', 'Dhuhr': 'Dhuhr', 'Asr': 'Asr', 'Maghrib': 'Maghrib', 'Isha': 'Isha'},
    'ar': { 'nav_title': 'قائمة التنقل', 'nav_doa': '🤲 أدعية يومية', 'nav_quran': '📖 القرآن الكريم', 'nav_dzikir': '📿 ذكر وتسبيح', 'nav_kiblat': '🧭 القبلة', 'nav_settings': '⚙️ الإعدادات', 'remaining_time': 'الوقت المتبقي', 'settings_title': 'الإعدادات', 'settings_dark_mode': 'الوضع الداكن', 'settings_notifications': 'إشعارات الأذان', 'settings_language': 'اللغة', 'settings_about': 'حول التطبيق', 'settings_adhan_sound': 'إعدادات صوت الأذان', 'last_read': 'آخر ما قرئ', 'no_last_read': 'لم يتم قراءة أي دعاء بعد', 'all_doa': 'كل الأدعية', 'bookmarked': 'المحفوظة', 'Imsak': 'إمساك', 'Fajr': 'الفجر', 'Sunrise': 'الشروق', 'Dhuhr': 'الظهر', 'Asr': 'العصر', 'Maghrib': 'المغرب', 'Isha': 'العشاء'},
    'tr': { 'nav_title': 'Navigasyon Menüsü', 'nav_doa': '🤲 Günlük Dualar', 'nav_quran': '📖 Kur\'an-ı Kerim', 'nav_dzikir': '📿 Zikir & Tesbih', 'nav_kiblat': '🧭 Kıble', 'nav_settings': '⚙️ Ayarlar', 'remaining_time': 'Kalan Süre', 'settings_title': 'Ayarlar', 'settings_dark_mode': 'Karanlık Mod', 'settings_notifications': 'Ezan Bildirimleri', 'settings_language': 'Dil', 'settings_about': 'Uygulama Hakkında', 'settings_adhan_sound': 'Ezan Sesi Ayarları', 'last_read': 'SON OKUNAN', 'no_last_read': 'Henüz okunmuş dua yok', 'all_doa': 'Tüm Dualar', 'bookmarked': 'İşaretli', 'Imsak': 'İmsak', 'Fajr': 'Sabah', 'Sunrise': 'Güneş', 'Dhuhr': 'Öğle', 'Asr': 'İkindi', 'Maghrib': 'Akşam', 'Isha': 'Yatsı'},
    'fr': { 'nav_title': 'Menu de navigation', 'nav_doa': '🤲 Prières quotidiennes', 'nav_quran': '📖 Al-Coran', 'nav_dzikir': '📿 Dhikr & Tasbih', 'nav_kiblat': '🧭 Qibla', 'nav_settings': '⚙️ Paramètres', 'remaining_time': 'Temps restant', 'settings_title': 'Paramètres', 'settings_dark_mode': 'Mode sombre', 'settings_notifications': 'Notifications d\'Adhan', 'settings_language': 'Langue', 'settings_about': 'À propos de l\'application', 'settings_adhan_sound': 'Paramètres Sonores de l\'Adhan', 'last_read': 'DERNIÈRE LECTURE', 'no_last_read': 'Aucune prière n\'a encore été lue', 'all_doa': 'Toutes les prières', 'bookmarked': 'Marqué', 'Imsak': 'Imsak', 'Fajr': 'Fajr', 'Sunrise': 'Lever du soleil', 'Dhuhr': 'Dhuhr', 'Asr': 'Asr', 'Maghrib': 'Maghrib', 'Isha': 'Isha' },
    'es': { 'nav_title': 'Menú de Navegación', 'nav_doa': '🤲 Oraciones Diarias', 'nav_quran': '📖 Al-Corán', 'nav_dzikir': '📿 Dhikr y Tasbih', 'nav_kiblat': '🧭 Quibla', 'nav_settings': '⚙️ Ajustes', 'remaining_time': 'Tiempo restante', 'settings_title': 'Ajustes', 'settings_dark_mode': 'Modo Oscuro', 'settings_notifications': 'Notificaciones de Adhan', 'settings_language': 'Idioma', 'settings_about': 'Acerca de la App', 'settings_adhan_sound': 'Ajustes de Sonido del Adhan', 'last_read': 'ÚLTIMA LECTURA', 'no_last_read': 'Aún no se han leído oraciones', 'all_doa': 'Todas las Oraciones', 'bookmarked': 'Marcado', 'Imsak': 'Imsak', 'Fajr': 'Fajr', 'Sunrise': 'Amanecer', 'Dhuhr': 'Dhuhr', 'Asr': 'Asr', 'Maghrib': 'Maghrib', 'Isha': 'Isha' },
    'de': { 'nav_title': 'Navigationsmenü', 'nav_doa': '🤲 Tägliche Gebete', 'nav_quran': '📖 Al-Quran', 'nav_dzikir': '📿 Dhikr & Tasbih', 'nav_kiblat': '🧭 Qibla', 'nav_settings': '⚙️ Einstellungen', 'remaining_time': 'Verbleibende Zeit', 'settings_title': 'Einstellungen', 'settings_dark_mode': 'Dunkelmodus', 'settings_notifications': 'Adhan-Benachrichtigungen', 'settings_language': 'Sprache', 'settings_about': 'Über die App', 'settings_adhan_sound': 'Adhan-Toneinstellungen', 'last_read': 'ZULETZT GELESEN', 'no_last_read': 'Noch keine Gebete gelesen', 'all_doa': 'Alle Gebete', 'bookmarked': 'Gemerkt', 'Imsak': 'Imsak', 'Fajr': 'Fajr', 'Sunrise': 'Sonnenaufgang', 'Dhuhr': 'Dhuhr', 'Asr': 'Asr', 'Maghrib': 'Maghrib', 'Isha': 'Isha' },
    'ru': { 'nav_title': 'Навигационное меню', 'nav_doa': '🤲 Ежедневные молитвы', 'nav_quran': '📖 Аль-Коран', 'nav_dzikir': '📿 Зикр и Тасбих', 'nav_kiblat': '🧭 Кибла', 'nav_settings': '⚙️ Настройки', 'remaining_time': 'Оставшееся время', 'settings_title': 'Настройки', 'settings_dark_mode': 'Темный режим', 'settings_notifications': 'Уведомления о Азане', 'settings_language': 'Язык', 'settings_about': 'О приложении', 'settings_adhan_sound': 'Настройки звука Азана', 'last_read': 'ПОСЛЕДНЕЕ ПРОЧТЕНИЕ', 'no_last_read': 'Молитвы еще не читались', 'all_doa': 'Все молитвы', 'bookmarked': 'В закладках', 'Imsak': 'Имсак', 'Фаджр': 'Fajr', 'Восход': 'Sunrise', 'Зухр': 'Dhuhr', 'Аср': 'Asr', 'Магриб': 'Maghrib', 'Иша': 'Isha' },
    'ur': { 'nav_title': 'نیویگیشن مینو', 'nav_doa': '🤲 روزانہ کی دعائیں', 'nav_quran': '📖 القرآن', 'nav_dzikir': '📿 ذکر و تسبیح', 'nav_kiblat': '🧭 قبلہ', 'nav_settings': '⚙️ ترتیبات', 'remaining_time': 'باقی وقت', 'settings_title': 'ترتیبات', 'settings_dark_mode': 'ڈارک موڈ', 'settings_notifications': 'اذان کی اطلاعات', 'settings_language': 'زبان', 'settings_about': 'ایپ کے بارے میں', 'settings_adhan_sound': 'اذان کی آواز کی ترتیبات', 'last_read': 'آخری بار پڑھا گیا', 'no_last_read': 'ابھی تک کوئی دعا نہیں پڑھی گئی', 'all_doa': 'تمام دعائیں', 'bookmarked': 'نشان زد', 'Imsak': 'امساک', 'Fajr': 'فجر', 'Sunrise': 'طلوع آفتاب', 'Dhuhr': 'ظہر', 'Asr': 'عصر', 'Maghrib': 'مغرب', 'Isha': 'عشاء' },
    'bn': { 'nav_title': 'নেভিগেশন মেনু', 'nav_doa': '🤲 দৈনিক দোয়া', 'nav_quran': '📖 আল-কুরআন', 'nav_dzikir': '📿 যিকির ও তাসবীহ', 'nav_kiblat': '🧭 কিবলা', 'nav_settings': '⚙️ সেটিংস', 'remaining_time': 'অবশিষ্ট সময়', 'settings_title': 'সেটিংস', 'settings_dark_mode': 'ডার্ক মোড', 'settings_notifications': 'আযানের নোটিফিকেশন', 'settings_language': 'ভাষা', 'settings_about': 'অ্যাপ সম্পর্কে', 'settings_adhan_sound': 'আযানের শব্দ সেটিংস', 'last_read': 'শেষ পঠিত', 'no_last_read': 'এখনও কোন দোয়া পড়া হয়নি', 'all_doa': 'সব দোয়া', 'bookmarked': 'বুকমার্ক করা', 'Imsak': 'ইمسাক', 'Fajr': 'ফজর', 'Sunrise': 'সূর্যোদয়', 'Dhuhr': 'যোহর', 'Asr': 'আসর', 'Maghrib': 'মাগরিব', 'Isha': 'ঈশা' }
};
const juzToSurahMap = { 1:[1,2],2:[2],3:[2,3],4:[3,4],5:[4],6:[4,5],7:[5,6],8:[6,7],9:[7,8],10:[8,9],11:[9,10,11],12:[11,12],13:[12,13,14,15],14:[16,17],15:[17,18],16:[18,19,20],17:[21,22],18:[23,24,25],19:[25,26,27],20:[27,28,29],21:[29,30,31,32,33],22:[33,34,35,36],23:[36,37,38,39],24:[39,40,41],25:[41,42,43,44,45],26:[46,47,48,49,50,51],27:[51,52,53,54,55,56,57],28:[58,59,60,61,62,63,64,65,66],29:[67,68,69,70,71,72,73,74,75,76,77],30:[78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114]};

// --- FUNGSI PERMINTAAN PENYIMPANAN PERMANEN ---
async function requestPersistentStorage() {
  if (navigator.storage && navigator.storage.persist) {
    try {
      const isPersisted = await navigator.storage.persisted();
      console.log(`Penyimpanan sudah permanen: ${isPersisted}`);
      if (!isPersisted) {
        const result = await navigator.storage.persist();
        console.log(`Berhasil meminta penyimpanan permanen: ${result}`);
      }
    } catch (error) {
      console.error('Gagal memeriksa atau meminta penyimpanan permanen:', error);
    }
  }
}

// --- SCRIPT UTAMA ---
document.addEventListener('DOMContentLoaded', () => {
    // --- GLOBAL VARIABLES & STATE ---
    let currentLanguage = 'id';
    let countdownInterval;
    let bookmarkedDoas = JSON.parse(localStorage.getItem('bookmarked_doas')) || [];
    let lastReadDoaId = localStorage.getItem('last_read_doa_id');
    let currentOpenDoaId = null;
    let dzikirState = JSON.parse(localStorage.getItem('dzikir_state')) || {};
    let currentDzikirId = null;
    window.latestPrayerTimes = null;
    let lastCheckedDate = new Date().getDate();
    
    // Quran State
    let allSurahsData = [];
    let bookmarkedSurahs = JSON.parse(localStorage.getItem('bookmarked_surahs')) || [];
    let lastReadSurah = JSON.parse(localStorage.getItem('last_read_surah'));
    let currentOpenSurahNumber = null;

    // Pengaturan audio
    const adhanSoundFiles = {
      'none': { name: 'Tanpa Suara' },
      'notification': { name: 'Notifikasi', audioId: 'audio-notification' },
      'fajr': { name: 'Muazin Subuh', audioId: 'audio-adhan-fajr' },
      'mishary': { name: 'Muazin Makkah (Mishary)', audioId: 'audio-adhan-mishary' },
      'madinah': { name: 'Muazin Madinah', audioId: 'audio-adhan-madinah' },
      'al_afasy': { name: 'Muazin Al-Afasy', audioId: 'audio-adhan-mishary' },
      'abdul_basit': { name: 'Muazin Abdul Basit', audioId: 'audio-adhan-madinah' } 
    };
    const adhanOptionsMap = {
        Imsak: ['none', 'notification', 'mishary', 'madinah'],
        Fajr: ['none', 'notification', 'fajr', 'mishary', 'madinah', 'al_afasy', 'abdul_basit'],
        Sunrise: ['none', 'notification'],
        Dhuhr: ['none', 'notification', 'mishary', 'madinah', 'al_afasy', 'abdul_basit'],
        Asr: ['none', 'notification', 'mishary', 'madinah', 'al_afasy', 'abdul_basit'],
        Maghrib: ['none', 'notification', 'mishary', 'madinah', 'al_afasy', 'abdul_basit'],
        Isha: ['none', 'notification', 'mishary', 'madinah', 'al_afasy', 'abdul_basit']
    };

    function migrateAudioSettings(settings) {
        const newSettings = {};
        let needsUpdate = false;
        for (const key in settings) {
            const value = settings[key];
            if (typeof value === 'string') {
                newSettings[key] = { sound: value, volume: 1.0 };
                needsUpdate = true;
            } else if (typeof value === 'object' && value !== null && 'sound' in value && 'volume' in value) {
                newSettings[key] = value;
            } else {
                newSettings[key] = { sound: 'none', volume: 1.0 };
                needsUpdate = true;
            }
        }
        if (needsUpdate) {
            console.log("Migrating audio settings to new format.");
            localStorage.setItem('prayerAudioSettings', JSON.stringify(newSettings));
        }
        return newSettings;
    }

    const defaultAudioSettings = {
        Imsak:   { sound: 'notification', volume: 1.0 }, 
        Fajr:    { sound: 'fajr',         volume: 1.0 }, 
        Sunrise: { sound: 'none',         volume: 1.0 }, 
        Dhuhr:   { sound: 'mishary',      volume: 0.8 }, 
        Asr:     { sound: 'mishary',      volume: 0.8 }, 
        Maghrib: { sound: 'mishary',      volume: 0.8 }, 
        Isha:    { sound: 'mishary',      volume: 0.8 }
    };
    let prayerAudioSettings = JSON.parse(localStorage.getItem('prayerAudioSettings')) || defaultAudioSettings;
    prayerAudioSettings = migrateAudioSettings(prayerAudioSettings);
    
    // --- ELEMENT SELECTORS ---
    const sidebar = document.getElementById('sidebar');
    const menuToggle = document.getElementById('menu-toggle');
    const prayerListContainerEl = document.getElementById('prayer-list-container');
    const countdownTimerEl = document.getElementById('countdown-timer');
    const nextPrayerNameEl = document.getElementById('next-prayer-name');
    const calendarContainerEl = document.getElementById('calendar-view-container');
    const gregorianDateEl = document.getElementById('gregorian-date-display');
    const hijriDateEl = document.getElementById('hijri-date-display');
    
    // --- [PERBAIKAN] LOGIKA LOKASI DAN JADWAL SHOLAT YANG BARU & LEBIH BAIK ---
    const CACHE_KEY_MONTHLY_TIMINGS = 'prayer_monthly_timings';
    const CACHE_KEY_CITY = 'prayer_city_data';
    const CACHE_KEY_COORDS = 'prayer_coords';

    function loadPrayerDataFromCache() {
        const cachedCity = localStorage.getItem(CACHE_KEY_CITY);
        if (cachedCity) {
            document.getElementById('city-name').textContent = cachedCity;
        }

        const today = new Date();
        const year = today.getFullYear();
        const month = today.getMonth() + 1;
        const day = today.getDate();
        const cacheKey = `timings_${year}_${month}`;

        const monthlyData = JSON.parse(localStorage.getItem(CACHE_KEY_MONTHLY_TIMINGS));
        
        if (monthlyData && monthlyData.key === cacheKey) {
            console.log("Memuat jadwal sholat dari cache bulanan.");
            const todayData = monthlyData.data[day - 1];
            if(todayData) {
                const todayTimings = todayData.timings;
                const todayHijri = todayData.date.hijri;
                const hijriText = `${todayHijri.day} ${todayHijri.month.en} ${todayHijri.year} H`;
                
                hijriDateEl.textContent = hijriText;
                window.latestPrayerTimes = todayTimings;
                renderPrayerTimes(todayTimings);
                startCountdown(todayTimings);
                return true;
            }
        }
        console.log("Cache tidak valid atau tidak tersedia untuk hari ini.");
        return false;
    }

    function fetchCityName(lat, lon) {
        fetch(`https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lon}&format=json`)
            .then(r => r.json())
            .then(data => {
                const cityName = data.address.city || data.address.town || data.address.village || "Lokasi Tidak Diketahui";
                document.getElementById('city-name').textContent = cityName;
                localStorage.setItem(CACHE_KEY_CITY, cityName);
            })
            .catch(error => {
                console.error("Gagal mengambil nama kota:", error);
                const cachedCity = localStorage.getItem(CACHE_KEY_CITY);
                if (cachedCity) document.getElementById('city-name').textContent = cachedCity;
            });
    }

    function fetchPrayerTimings(lat, lon) {
        document.getElementById('city-name').textContent = "Memperbarui jadwal...";
        const now = new Date();
        const year = now.getFullYear();
        const month = now.getMonth() + 1;

        fetch(`https://api.aladhan.com/v1/calendar/${year}/${month}?latitude=${lat}&longitude=${lon}&method=11`)
            .then(r => r.json())
            .then(j => {
                if (j.code === 200) {
                    console.log("Berhasil mengambil data jadwal sholat baru untuk sebulan dari API.");
                    localStorage.setItem(CACHE_KEY_COORDS, JSON.stringify({lat, lon}));
                    const cacheKey = `timings_${year}_${month}`;
                    const adjustedData = j.data.map(dailyData => {
                        const adjustedTimings = {};
                        for (const key in dailyData.timings) {
                            const timeString = dailyData.timings[key].split(' ')[0]; 
                            const [h, m] = timeString.split(':').map(Number);
                            if (!isNaN(h) && !isNaN(m)) {
                                const date = new Date();
                                date.setHours(h, m + 2, 0, 0); 
                                adjustedTimings[key] = `${String(date.getHours()).padStart(2, '0')}:${String(date.getMinutes()).padStart(2, '0')}`;
                            } else {
                                adjustedTimings[key] = dailyData.timings[key];
                            }
                        }
                        return { ...dailyData, timings: adjustedTimings };
                    });
                    const dataToStore = { key: cacheKey, data: adjustedData };
                    localStorage.setItem(CACHE_KEY_MONTHLY_TIMINGS, JSON.stringify(dataToStore));
                    console.log("Data jadwal sholat sebulan penuh telah disimpan ke cache.");
                    
                    loadPrayerDataFromCache(); 
                    fetchCityName(lat, lon); // Panggil juga fetch city name di sini
                } else {
                    console.error("API Aladhan mengembalikan error.");
                    handleLocationError({message: "API Error"});
                }
            })
            .catch(error => {
                console.error("Gagal mengambil jadwal sholat (kemungkinan offline):", error);
                handleLocationError(error);
            });
    }

    function handleLocationError(error) {
        console.warn(`Error getting location: ${error.message}.`);
        document.getElementById('city-name').textContent = "Gagal dapat lokasi";
        // Coba lagi dari cache. Jika gagal total, baru pakai fallback
        if (!loadPrayerDataFromCache()) {
            console.warn("Cache juga gagal. Menggunakan lokasi fallback (Medan).");
            fetchPrayerTimings(3.5952, 98.6722); // Fallback ke Medan
            document.getElementById('city-name').textContent = "Medan (Fallback)";
        }
    }

    // Fungsi utama yang menangani semua alur permintaan lokasi
    function requestLocationAndFetchData() {
        document.getElementById('city-name').textContent = "Mencari lokasi...";
        if (!navigator.geolocation) {
            handleLocationError({ message: "Geolocation tidak didukung browser ini." });
            return;
        }

        navigator.geolocation.getCurrentPosition(
            (position) => {
                // Sukses
                console.log("Lokasi berhasil didapatkan.");
                fetchPrayerTimings(position.coords.latitude, position.coords.longitude);
            },
            (error) => {
                // Gagal
                handleLocationError(error);
            },
            { enableHighAccuracy: true, timeout: 20000, maximumAge: 0 }
        );
    }
    
    // Inisialisasi utama untuk lokasi dan jadwal sholat
    async function initLocationAndPrayerTimes() {
        // Coba muat dari cache dulu, ini sangat cepat
        if (loadPrayerDataFromCache()) {
            console.log("Sukses memuat dari cache, tidak perlu meminta lokasi baru.");
            return;
        }
        
        // Jika tidak ada cache, cek status izin
        try {
            const permissionStatus = await navigator.permissions.query({ name: 'geolocation' });

            if (permissionStatus.state === 'granted') {
                // Jika izin sudah ada, langsung minta lokasi
                console.log("Izin lokasi sudah ada, langsung ambil data.");
                requestLocationAndFetchData();
            } else if (permissionStatus.state === 'prompt') {
                // Jika butuh izin, tampilkan modal kustom kita
                console.log("Membutuhkan izin, tampilkan modal kustom.");
                document.getElementById('custom-location-modal').style.display = 'flex';
            } else { // denied
                // Jika ditolak, langsung jalankan alur error
                console.log("Izin lokasi ditolak sebelumnya.");
                handleLocationError({ message: "Izin lokasi telah ditolak." });
            }
        } catch (error) {
            console.error("Gagal memeriksa status izin, mungkin browser tidak mendukung. Coba minta langsung.", error);
            requestLocationAndFetchData(); // Fallback untuk browser lama
        }
    }

    function setupCustomPermissionModals() {
        const locationModal = document.getElementById('custom-location-modal');
        const allowLocationBtn = document.getElementById('allow-location-btn');
        const denyLocationBtn = document.getElementById('deny-location-btn');

        // Tombol "Izinkan" pada modal akan memicu permintaan lokasi asli
        allowLocationBtn.addEventListener('click', () => {
            locationModal.style.display = 'none';
            requestLocationAndFetchData(); // Panggil fungsi utama di sini
        });

        denyLocationBtn.addEventListener('click', () => {
            locationModal.style.display = 'none';
            handleLocationError({ message: "Pengguna menolak dari modal kustom." });
        });

        // Setup untuk modal notifikasi (tidak berubah banyak)
        const notificationModal = document.getElementById('custom-notification-modal');
        const allowNotificationBtn = document.getElementById('allow-notification-btn');
        const denyNotificationBtn = document.getElementById('deny-notification-btn');
        
        window.requestNotificationPermission = function() {
            return new Promise((resolve, reject) => {
                if ('Notification' in window) {
                    if (Notification.permission === 'granted') {
                        resolve('granted');
                    } else if (Notification.permission === 'default') {
                        notificationModal.style.display = 'flex';
                        allowNotificationBtn.onclick = () => {
                            notificationModal.style.display = 'none';
                            Notification.requestPermission().then(resolve);
                        };
                        denyNotificationBtn.onclick = () => {
                            notificationModal.style.display = 'none';
                            reject('denied_by_custom_modal');
                        };
                    } else {
                        reject('denied_previously');
                    }
                } else {
                    reject('not_supported');
                }
            });
        }
    }
    // --- AKHIR BLOK PERBAIKAN ---

    window.checkForDateChangeAndRefetch = function() {
        const currentDate = new Date().getDate();
        if (currentDate !== lastCheckedDate) {
            console.log("Pergantian hari terdeteksi, memuat ulang jadwal sholat...");
            lastCheckedDate = currentDate;
            const coords = JSON.parse(localStorage.getItem(CACHE_KEY_COORDS));
            if(coords) {
                fetchPrayerTimings(coords.lat, coords.lon);
            }
            updateDates();
        }
    };

    // --- CORE APP LOGIC (Sebagian besar tidak berubah) ---
    function showView(viewId) {
        document.querySelectorAll('.main-view').forEach(v => v.style.display = 'none');
        const appContainer = document.querySelector('.app-container');
        const tasbihView = document.getElementById('tasbih-view');
        const qiblaView = document.getElementById('qibla-view');
        const targetView = document.getElementById(viewId);
        
        document.body.style.backgroundColor = ''; 
        if(viewId === 'qibla-view') {
            document.body.style.backgroundColor = '#000000';
        }

        if (viewId === 'tasbih-view' || viewId === 'qibla-view') {
            appContainer.style.display = 'none';
            if (viewId === 'tasbih-view') tasbihView.style.display = 'flex';
            if (viewId === 'qibla-view') qiblaView.style.display = 'flex';
        } else {
            appContainer.style.display = 'block';
            tasbihView.style.display = 'none';
            qiblaView.style.display = 'none';
            if (targetView) targetView.style.display = 'block';
        }
        
        const prayerView = document.getElementById('prayer-times-view');
        menuToggle.style.display = (prayerView.style.display === 'block' && viewId !== 'qibla-view' && viewId !== 'tasbih-view') ? 'flex' : 'none';
    }
    
    function closeSidebar() {
        menuToggle.classList.remove('open');
        sidebar.classList.remove('open');
    }
    
    function setupNavigation() {
        document.getElementById('prayer-times-btn').addEventListener('click', (e) => { e.preventDefault(); showView('prayer-times-view'); closeSidebar(); });
        document.getElementById('doa-harian-btn').addEventListener('click', (e) => { e.preventDefault(); showView('doa-view'); renderDoaListView('all'); closeSidebar(); });
        document.getElementById('quran-btn').addEventListener('click', (e) => { e.preventDefault(); showView('quran-view'); renderQuranView('surah'); closeSidebar(); });
        document.getElementById('dzikir-btn').addEventListener('click', (e) => { e.preventDefault(); showView('dzikir-view'); renderDzikirList(); closeSidebar(); });
        document.getElementById('settings-btn').addEventListener('click', (e) => { 
            e.preventDefault(); 
            document.getElementById('settings-modal').style.display = 'flex'; 
            closeSidebar(); 
        });
        
        document.querySelectorAll('.back-button').forEach(btn => {
            btn.addEventListener('click', () => {
                const targetViewId = btn.getAttribute('data-target-view');
                if (targetViewId) {
                    showView(targetViewId);
                }
            });
        });
    
        menuToggle.addEventListener('click', (e) => { e.stopPropagation(); menuToggle.classList.toggle('open'); sidebar.classList.toggle('open'); });
        document.addEventListener('click', (e) => {
            if (sidebar.classList.contains('open') && !sidebar.contains(e.target) && !menuToggle.contains(e.target)) {
                closeSidebar();
            }
        });
    }
    
    // --- PRAYER TIMES FEATURE (TIDAK BERUBAH) ---
    function stopAllAdhanAudio() {
        document.querySelectorAll('audio[id^="audio-adhan-"], audio[id^="audio-notification"]').forEach(audio => {
            if (!audio.paused) {
                audio.pause();
                audio.currentTime = 0;
            }
        });
    }

    function playPrayerAudio(prayerName) {
        const setting = prayerAudioSettings[prayerName];
        if (!setting || setting.sound === 'none') {
            console.log(`Audio untuk ${prayerName} di-nonaktifkan.`);
            return;
        }

        const option = adhanSoundFiles[setting.sound];
        if (option && option.audioId) {
            const audioElement = document.getElementById(option.audioId);
            if (audioElement) {
                stopAllAdhanAudio();
                audioElement.volume = setting.volume; 
                audioElement.currentTime = 0;
                const playPromise = audioElement.play();
                if (playPromise !== undefined) {
                    playPromise.catch(error => {
                        console.error(`Gagal memutar audio untuk ${prayerName}:`, error);
                        showPrayerNotification(translations[currentLanguage][prayerName] || prayerName, 'Gagal memutar adzan otomatis. Pastikan interaksi halaman sudah dilakukan.');
                    });
                }
            }
        }
    }

    function showPrayerNotification(prayerName, customBody = null) {
      if (Notification.permission !== 'granted') return;
      const notificationTitle = `Waktunya Sholat ${prayerName}`;
      const notificationOptions = {
          body: customBody || `Sekarang telah masuk waktu sholat ${prayerName}.`,
          icon: 'logo-annur.jpg',
          tag: 'prayer-time-notification',
          renotify: true
      };
      navigator.serviceWorker.ready.then(registration => {
          registration.showNotification(notificationTitle, notificationOptions);
      });
    }
    
    function renderPrayerTimes(prayerTimes) {
        if (!prayerListContainerEl) return;
        prayerListContainerEl.innerHTML = '';
        
        const prayerOrder = ['Imsak', 'Fajr', 'Sunrise', 'Dhuhr', 'Asr', 'Maghrib', 'Isha'];

        prayerOrder.forEach(key => {
            if (prayerTimes[key]) {
                const prayerName = translations[currentLanguage][key] || key;
                const prayerTime = prayerTimes[key];

                const prayerItemHtml = `
                    <div class="prayer-item">
                        <div class="prayer-details">
                            <div class="prayer-name">${prayerName}</div>
                        </div>
                        <div class="prayer-time-value">${prayerTime}</div>
                    </div>`;
                
                prayerListContainerEl.innerHTML += prayerItemHtml;
            }
        });
    }
    
    function startCountdown(prayerTimes) {
        if (countdownInterval) clearInterval(countdownInterval);
        const prayerOrder = ['Imsak', 'Fajr', 'Sunrise', 'Dhuhr', 'Asr', 'Maghrib', 'Isha'];
        let triggeredPrayers = [];

        function update() {
            checkForDateChangeAndRefetch();
            const now = new Date();
            let nextPrayerTime, nextPrayerName;
            
            for (const name of prayerOrder) {
                const prayerDate = new Date(`${now.toDateString()} ${prayerTimes[name]}`);
                if (prayerDate > now && !triggeredPrayers.includes(name)) {
                    nextPrayerTime = prayerDate;
                    nextPrayerName = name;
                    break;
                }
            }

            if (!nextPrayerTime) {
                const tomorrow = new Date(now);
                tomorrow.setDate(now.getDate() + 1);
                nextPrayerTime = new Date(`${tomorrow.toDateString()} ${prayerTimes['Imsak']}`);
                nextPrayerName = 'Imsak';
                triggeredPrayers = [];
            }

            const diff = nextPrayerTime - now;
            if (diff < 0) return;

            if (diff <= 1000 && !triggeredPrayers.includes(nextPrayerName)) {
                const translatedPrayerName = translations[currentLanguage][nextPrayerName] || nextPrayerName;
                showPrayerNotification(translatedPrayerName);
                playPrayerAudio(nextPrayerName);
                triggeredPrayers.push(nextPrayerName); 
                
                setTimeout(() => {
                  if (window.latestPrayerTimes) {
                    startCountdown(window.latestPrayerTimes);
                  }
                }, 2000);
            }
            
            const h = String(Math.floor(diff / 3600000)).padStart(2, '0');
            const m = String(Math.floor((diff % 3600000) / 60000)).padStart(2, '0');
            const s = String(Math.floor((diff % 60000) / 1000)).padStart(2, '0');
            countdownTimerEl.textContent = `${h}:${m}:${s}`;
            nextPrayerNameEl.textContent = translations[currentLanguage][nextPrayerName] || nextPrayerName;
        }

        update();
        countdownInterval = setInterval(update, 1000);
        
        document.addEventListener("visibilitychange", () => {
          if (document.visibilityState === "visible") {
            console.log("Tab is visible again, syncing countdown...");
            update();
          }
        });
    }
    
    function generateCalendar() {
        if (!calendarContainerEl) return;
        const dayNamesList = { 
            id: ["Min", "Sen", "Sel", "Rab", "Kam", "Jum", "Sab"], en: ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"], ar: ["أحد", "إثن", "ثلا", "أرب", "خمي", "جمع", "سبت"], tr: ["Paz", "Pzt", "Sal", "Çar", "Per", "Cum", "Cmt"], fr: ["Dim", "Lun", "Mar", "Mer", "Jeu", "Ven", "Sam"], es: ["Dom", "Lun", "Mar", "Mié", "Jue", "Vie", "Sáb"], de: ["So", "Mo", "Di", "Mi", "Do", "Fr", "Sa"], ru: ["Вс", "Пн", "Вт", "Ср", "Чт", "Пт", "Сб"], ur: ["اتوار", "پیر", "منگل", "بدھ", "جمعرات", "جمعہ", "ہفتہ"], bn: ["রবি", "সোম", "মঙ্গল", "বুধ", "বৃহ", "শুক্র", "শনি"]
        };
        const today = new Date();
        const todayDayIndex = today.getDay();
        let calendarHtml = '';
        for (let i = 0; i < 7; i++) {
            const date = new Date();
            date.setDate(today.getDate() - (todayDayIndex - i));
            const isToday = i === todayDayIndex;
            calendarHtml += `<div class="day ${isToday ? 'today' : ''}"><span class="day-name">${dayNamesList[currentLanguage][i] || dayNamesList['id'][i]}</span><span class="day-number">${date.getDate()}</span></div>`;
        }
        calendarContainerEl.innerHTML = calendarHtml;
    }
    
    function updateDates() {
        if (!gregorianDateEl) return;
        const now = new Date();
        const localeMap = { id: 'id-ID', en: 'en-US', ar: 'ar-SA', tr: 'tr-TR', fr: 'fr-FR', es: 'es-ES', de: 'de-DE', ru: 'ru-RU', ur: 'ur-PK', bn: 'bn-BD' };
        const locale = localeMap[currentLanguage] || 'en-US';
        gregorianDateEl.textContent = now.toLocaleDateString(locale, { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' });
    }

    // --- DOA HARIAN FEATURE ---
    function setupDoaHarian() {
        const doaListContainer = document.getElementById('doa-list-container-view');
        const lastReadCard = document.getElementById('last-read-doa-card');
        const lastReadCardText = lastReadCard.querySelector('p');
        const singleDoaModal = document.getElementById('single-doa-modal');
    
        window.renderDoaListView = function(filter) {
            doaListContainer.innerHTML = '';
            let data = (filter === 'bookmarked') ? doaHarianData.filter(d => bookmarkedDoas.includes(d.id)) : doaHarianData;
            if (data.length === 0) { doaListContainer.innerHTML = `<p class="loading-indicator">Tidak ada doa yang ditandai.</p>`; return; }
            data.forEach((d, index) => {
                const item = document.createElement('div'); item.className = 'list-item';
                item.innerHTML = `<span class="num">${d.id}</span><div class="details"><div class="title">${d.title}</div><div class="subtitle">${d.subtitle}</div></div><span class="arabic">${d.arabic.split(' ')[0]}...</span>`;
                item.addEventListener('click', () => showSingleDoa(d.id));
                doaListContainer.appendChild(item);
            });
        }
        function showSingleDoa(id) {
            const doa = doaHarianData.find(d => d.id === id); if (!doa) return;
            currentOpenDoaId = id;
            singleDoaModal.querySelector('#single-doa-modal-title').textContent = doa.title;
            singleDoaModal.querySelector('#single-doa-modal-body').innerHTML = `
                                            <p class="single-item-arabic">${doa.arabic}</p>
                                            <p class="single-item-latin">${doa.latin}</p>
                                            <hr style="margin: 1.5rem 0; border: 0; border-top: 1px solid #eee;">
                                            <p class="single-item-arti"><b>Artinya:</b> ${doa.arti}</p>`;
            updateBookmarkIcon(); singleDoaModal.style.display = 'flex';
            localStorage.setItem('last_read_doa_id', id); lastReadDoaId = id; renderLastRead();
        }
        function renderLastRead() {
            const p = lastReadCardText;
            if (lastReadDoaId) { const doa = doaHarianData.find(d => d.id == lastReadDoaId); p.textContent = doa ? doa.title : 'Belum ada doa yang dibaca'; } 
            else { p.textContent = 'Belum ada doa yang dibaca'; }
        }
        function updateBookmarkIcon() { singleDoaModal.querySelector('#bookmark-doa-btn').classList.toggle('bookmarked', bookmarkedDoas.includes(currentOpenDoaId)); }
        
        lastReadCard.addEventListener('click', () => { if (lastReadDoaId) showSingleDoa(parseInt(lastReadDoaId)); });
        singleDoaModal.querySelector('#bookmark-doa-btn').addEventListener('click', () => {
            const index = bookmarkedDoas.indexOf(currentOpenDoaId);
            if (index > -1) bookmarkedDoas.splice(index, 1); else bookmarkedDoas.push(currentOpenDoaId);
            localStorage.setItem('bookmarked_doas', JSON.stringify(bookmarkedDoas)); updateBookmarkIcon();
            if (document.querySelector('#doa-view .tab-item.active').dataset.tab === 'bookmarked') renderDoaListView('bookmarked');
        });
        document.querySelectorAll('#doa-view .tab-item').forEach(tab => tab.addEventListener('click', () => {
            document.querySelector('#doa-view .tab-item.active').classList.remove('active');
            tab.classList.add('active'); renderDoaListView(tab.dataset.tab);
        }));
        singleDoaModal.querySelector('.close-button').addEventListener('click', () => singleDoaModal.style.display = 'none');
        renderLastRead();
    }
    
// --- GANTI FUNGSI QURAN LAMA ANDA DENGAN KESELURUHAN KODE DI BAWAH INI ---
function setupQuranFeature() {
    const quranListContainer = document.getElementById('quran-list-container');
    const quranTabs = document.getElementById('quran-tabs');
    const lastReadSurahCard = document.getElementById('last-read-surah-card');
    const lastReadSurahCardText = lastReadSurahCard.querySelector('p');
    const surahViewTitle = document.getElementById('surah-view-title');
    const surahViewBookmarkBtn = document.getElementById('surah-view-bookmark-btn');
    const surahViewBody = document.getElementById('surah-view-body');
    const surahViewBackBtn = document.getElementById('surah-view-back-btn');
    const juzDetailTitle = document.getElementById('juz-detail-title');
    const juzSurahListContainer = document.getElementById('juz-surah-list-container');
    const murottalPlayer = document.getElementById('murottal-player');

    const qariData = {
        "ar.alafasy": "Mishary Rashid Al-Afasy",
        "ar.abdurrahmaansudais": "Abdurrahman As-Sudais",
        "ar.abdulsamad": "Abdul Samad",
        "ar.saoodshuraym": "Saud Al-Shuraim",
        "ar.husarymujawwad": "Mahmoud Khalil Al-Hussary (Mujawwad)"
    };
    
    let selectedQariIdentifier = localStorage.getItem('selected_qari_identifier') || 'ar.alafasy';

    let surahAudioData = {}; 
    let currentPlayingAyahIndex = 0;
    let isPlaylistPlaying = false;

    async function fetchAllSurahs() {
        if (allSurahsData.length > 0) return allSurahsData;
        try {
            quranListContainer.innerHTML = `<div class="loading-indicator">Memuat data surah...</div>`;
            const response = await fetch('https://api.quran.gading.dev/surah');
            const data = await response.json();
            if (data.code === 200) {
                allSurahsData = data.data;
                return allSurahsData;
            }
        } catch (error) {
            console.error("Error fetching surah list:", error);
            quranListContainer.innerHTML = `<div class="loading-indicator">Gagal dimuat. Periksa koneksi.</div>`;
        }
        return [];
    }
    
    function renderSurahList(surahs, container, backTarget) {
        container.innerHTML = '';
        if (!surahs || surahs.length === 0) {
            container.innerHTML = `<div class="loading-indicator">Tidak ada data.</div>`;
            return;
        }
        surahs.forEach(surah => {
            const item = document.createElement('div');
            item.className = 'list-item';
            item.innerHTML = `
                <span class="num">${surah.number}</span>
                <div class="details">
                    <div class="title">${surah.name.transliteration.id}</div>
                    <div class="subtitle">${surah.name.translation.id} (${surah.numberOfVerses} ayat)</div>
                </div>
                <span class="arabic">${surah.name.short}</span>`;
            item.addEventListener('click', () => showSurahDetail(surah.number, backTarget));
            container.appendChild(item);
        });
    }

    function renderJuzList() {
        quranListContainer.innerHTML = '';
        for (let i = 1; i <= 30; i++) {
            const item = document.createElement('div');
            item.className = 'list-item';
            item.innerHTML = `
                <span class="num">${i}</span>
                <div class="details"><div class="title">Juz ${i}</div></div>
                <span class="arabic">الجزء ${i}</span>`;
            item.addEventListener('click', () => showSurahsInJuz(i));
            quranListContainer.appendChild(item);
        }
    }

    async function showSurahsInJuz(juzNumber) {
        juzDetailTitle.textContent = `Daftar Surah di Juz ${juzNumber}`;
        juzSurahListContainer.innerHTML = `<div class="loading-indicator">Memuat...</div>`;
        showView('juz-detail-view');
        const surahs = await fetchAllSurahs();
        const surahNumbersInJuz = [...new Set(juzToSurahMap[juzNumber])];
        const surahsInJuz = surahs.filter(s => surahNumbersInJuz.includes(s.number));
        renderSurahList(surahsInJuz, juzSurahListContainer, 'juz-detail-view');
    }

    function stopPlaylist() {
        isPlaylistPlaying = false;
        murottalPlayer.pause();
        murottalPlayer.src = '';
        currentPlayingAyahIndex = 0;
        document.querySelectorAll('.ayah-item.ayah-playing').forEach(el => el.classList.remove('ayah-playing'));
        const playBtn = document.getElementById('surah-play-btn');
        if (playBtn) playBtn.innerHTML = '▶️';
    }

    function playAyah(index) {
        if (!surahAudioData.ayahs || !surahAudioData.ayahs[index]) {
            console.log(`Surah ${currentOpenSurahNumber} selesai.`);
            if (currentOpenSurahNumber >= 114) {
                console.log("Murottal Al-Qur'an telah selesai. Pemutaran berhenti.");
                stopPlaylist();
                return;
            }
            const nextSurahNumber = currentOpenSurahNumber + 1;
            console.log(`Lanjut otomatis ke surah berikutnya: ${nextSurahNumber}`);
            showSurahDetail(nextSurahNumber, 'quran-view', true); 
            return;
        }

        currentPlayingAyahIndex = index;
        const ayahNumberInSurah = surahAudioData.ayahs[index].numberInSurah;
        const ayahElement = document.getElementById(`ayah-item-${ayahNumberInSurah}`);
        
        document.querySelectorAll('.ayah-item.ayah-playing').forEach(el => el.classList.remove('ayah-playing'));
        
        if (ayahElement) {
            ayahElement.classList.add('ayah-playing');
            ayahElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
        
        const audioUrl = surahAudioData.ayahs[index].audio;
        murottalPlayer.src = audioUrl;
        murottalPlayer.play().catch(e => {
            console.error(`Gagal memutar audio untuk ayat ${ayahNumberInSurah}:`, e);
        });
    }

    function togglePlaylist() {
        isPlaylistPlaying = !isPlaylistPlaying;
        const playBtn = document.getElementById('surah-play-btn');
        if (isPlaylistPlaying) {
            playBtn.innerHTML = '⏸️';
            playAyah(currentPlayingAyahIndex);
        } else {
            playBtn.innerHTML = '▶️';
            murottalPlayer.pause();
        }
    }
    
    async function showSurahDetail(number, backTarget = 'quran-view', autoplay = false) {
        surahViewTitle.textContent = `Memuat Surah...`;
        surahViewBody.innerHTML = `<div class="loading-indicator">Memuat...</div>`;
        surahViewBackBtn.setAttribute('data-target-view', backTarget);
        showView('surah-view');
        
        // [PERBAIKAN] Panggil stopPlaylist() tanpa syarat di awal
        // Ini memastikan state (termasuk hitungan ayat) selalu di-reset setiap kali surah baru dibuka.
        stopPlaylist(); 
        
        try {
            const textResponse = await fetch(`https://api.quran.gading.dev/surah/${number}`);
            const textResult = await textResponse.json();
            if (textResult.code !== 200) throw new Error('Gagal memuat teks surah');
            const surah = textResult.data;

            const audioResponse = await fetch(`https://api.alquran.cloud/v1/surah/${number}/editions/${selectedQariIdentifier}`);
            const audioResult = await audioResponse.json();
            if (audioResult.code !== 200) throw new Error('Gagal memuat audio surah');
            surahAudioData = audioResult.data[0];

            currentOpenSurahNumber = surah.number;
            surahViewTitle.textContent = `${surah.name.transliteration.id}`;
            
            let contentHtml = `
                <div class="surah-detail-header">
                    <h2>${surah.name.long}</h2>
                    <p>${surah.name.translation.id}</p>
                    <div class="meta">${surah.revelation.id} • ${surah.numberOfVerses} AYAT</div>
                </div>
                <div class="surah-audio-player">
                    <button id="surah-play-btn">▶️</button>
                    <select id="qari-select" class="custom-select" style="flex-grow: 1; text-align: center;"></select>
                </div>
            `;
            if (surah.number !== 1 && surah.number !== 9) {
                contentHtml += `<div class="basmala"><p class="basmala-arabic">بِسْمِ ٱللَّهِ ٱلرَّحْمَٰنِ ٱلرَّحِيمِ</p></div>`;
            }

            surah.verses.forEach(ayah => {
                contentHtml += `
                    <div class="ayah-item" id="ayah-item-${ayah.number.inSurah}">
                        <div class="ayah-header"><span class="ayah-number">${surah.number}:${ayah.number.inSurah}</span></div>
                        <p class="ayah-arabic">${ayah.text.arab}</p>
                        <p class="ayah-latin">${ayah.text.transliteration.en}</p>
                        <p class="ayah-translation"><b>Artinya:</b> ${ayah.translation.id}</p>
                    </div>`;
            });
            surahViewBody.innerHTML = contentHtml;
            
            const qariSelect = document.getElementById('qari-select');
            for (const key in qariData) {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = qariData[key];
                if (key === selectedQariIdentifier) { option.selected = true; }
                qariSelect.appendChild(option);
            }

            qariSelect.addEventListener('change', function() {
                selectedQariIdentifier = this.value;
                localStorage.setItem('selected_qari_identifier', selectedQariIdentifier);
                stopPlaylist();
                showSurahDetail(number, backTarget); 
            });

            document.getElementById('surah-play-btn').addEventListener('click', togglePlaylist);
            lastReadSurah = { number: surah.number, name: surah.name.transliteration.id };
            localStorage.setItem('last_read_surah', JSON.stringify(lastReadSurah));
            updateLastReadSurahCard();
            surahViewBookmarkBtn.classList.toggle('bookmarked', bookmarkedSurahs.includes(surah.number));

            if (autoplay) {
                // Sedikit jeda untuk memastikan UI siap sebelum memulai audio
                setTimeout(() => {
                    togglePlaylist(); 
                }, 100);
            }

        } catch (error) {
            surahViewBody.innerHTML = `<div class="loading-indicator">Gagal memuat surah. Periksa koneksi internet dan coba lagi.</div>`;
            console.error("Error fetching surah detail:", error);
        }
    }
    
    function updateLastReadSurahCard() {
        if (lastReadSurah) {
            lastReadSurahCardText.textContent = `Surah ${lastReadSurah.name} (No. ${lastReadSurah.number})`;
        } else {
            lastReadSurahCardText.textContent = "Belum ada surah yang dibaca";
        }
    }

    lastReadSurahCard.addEventListener('click', () => {
        if (lastReadSurah && lastReadSurah.number) {
            showSurahDetail(lastReadSurah.number, 'quran-view');
        }
    });

    surahViewBookmarkBtn.addEventListener('click', function() {
        if (currentOpenSurahNumber === null) return;
        const index = bookmarkedSurahs.indexOf(currentOpenSurahNumber);
        if (index > -1) {
            bookmarkedSurahs.splice(index, 1);
        } else {
            bookmarkedSurahs.push(currentOpenSurahNumber);
        }
        this.classList.toggle('bookmarked');
        localStorage.setItem('bookmarked_surahs', JSON.stringify(bookmarkedSurahs));
    });

    quranTabs.addEventListener('click', (e) => {
        if (e.target.classList.contains('tab-item')) {
            quranTabs.querySelector('.tab-item.active').classList.remove('active');
            e.target.classList.add('active');
            renderQuranView(e.target.dataset.tab);
        }
    });

    murottalPlayer.addEventListener('ended', () => {
        if (isPlaylistPlaying) {
            playAyah(currentPlayingAyahIndex + 1);
        }
    });

    murottalPlayer.addEventListener('play', () => {
        const playBtn = document.getElementById('surah-play-btn');
        if (isPlaylistPlaying && playBtn) playBtn.innerHTML = '⏸️';
    });
    
    murottalPlayer.addEventListener('pause', () => {
        const playBtn = document.getElementById('surah-play-btn');
        if (isPlaylistPlaying && playBtn) playBtn.innerHTML = '▶️';
    });

    window.renderQuranView = async function(tab) {
        quranListContainer.innerHTML = `<div class="loading-indicator">Memuat...</div>`;
        const surahs = await fetchAllSurahs();
        if (tab === 'surah') {
            renderSurahList(surahs, quranListContainer, 'quran-view');
        } else if (tab === 'juz') {
            renderJuzList();
        } else if (tab === 'bookmarked') {
            const bookmarkedList = surahs.filter(s => bookmarkedSurahs.includes(s.number));
            if (bookmarkedList.length === 0) {
                quranListContainer.innerHTML = `<div class="loading-indicator">Tidak ada surah yang ditandai.</div>`;
            } else {
                renderSurahList(bookmarkedList, quranListContainer, 'quran-view');
            }
        }
    };
    
    updateLastReadSurahCard();
}
    
    // --- DZIKIR & TASBIH FEATURE ---
    function setupDzikir() {
        const dzikirListContainer = document.getElementById('dzikir-list-container');
        const dzikirDetailModal = document.getElementById('dzikir-detail-modal');
        const tasbihView = document.getElementById('tasbih-view');
        const tasbihTitle = document.getElementById('tasbih-title');
        const tasbihCurrentCount = document.getElementById('tasbih-current-count');
        const tasbihTargetCount = document.getElementById('tasbih-target-count');
        const tasbihTapArea = document.getElementById('tasbih-tap-area');
        const tasbihResetBtn = document.getElementById('tasbih-reset-btn');
    
        function saveState() { localStorage.setItem('dzikir_state', JSON.stringify(dzikirState)); }
        
        window.renderDzikirList = () => {
            dzikirListContainer.innerHTML = '';
            dzikirData.forEach((d, index) => {
                const item = document.createElement('div'); 
                item.className = 'list-item';
                item.innerHTML = `
                        <span class="num">📿</span>
                        <div class="details">
                            <div class="title">${d.title}</div>
                            <div class="subtitle">${d.subtitle}</div>
                        </div>
                        <span class="arabic">${d.arabic}</span>`;
                item.addEventListener('click', () => showDzikirDetailModal(d.id));
                dzikirListContainer.appendChild(item);
            });
        };
        
        function showDzikirDetailModal(id) {
            const dzikir = dzikirData.find(d => d.id === id); if (!dzikir) return;
            
            dzikirDetailModal.querySelector('#dzikir-detail-modal-title').textContent = dzikir.title;
            const modalBody = dzikirDetailModal.querySelector('#dzikir-detail-modal-body');
            modalBody.innerHTML = `
                                            <p class="single-item-arabic">${dzikir.arabic}</p>
                                            <p class="single-item-latin">${dzikir.latin}</p>
                                            <hr style="margin: 1.5rem 0; border: 0; border-top: 1px solid #eee;">
                                            <p class="single-item-arti"><b>Artinya:</b> ${dzikir.arti}</p>
                                            <button id="start-dzikir-btn" class="modal-action-btn">Mulai Dzikir (Target: ${dzikir.target})</button>
                                                                                                    `;
            
            modalBody.querySelector('#start-dzikir-btn').addEventListener('click', () => {
                dzikirDetailModal.style.display = 'none';
                showTasbihView(id);
            });
    
            dzikirDetailModal.style.display = 'flex';
        }
    
        dzikirDetailModal.querySelector('.close-button').addEventListener('click', () => {
            dzikirDetailModal.style.display = 'none';
        });
    
        function showTasbihView(id) {
            currentDzikirId = id; 
            const d = dzikirData.find(dz => dz.id === id);
            const s = dzikirState[id] || { count: 0, lap: 0 };
            
            tasbihTitle.textContent = d.title; 
            tasbihCurrentCount.textContent = s.count; 
            tasbihTargetCount.textContent = `/ ${d.target}`;
            
            tasbihView.querySelector('.tasbih-arabic').textContent = d.arabic;
            tasbihView.querySelector('.tasbih-latin').textContent = d.latin;
            tasbihView.querySelector('.tasbih-arti').textContent = `Artinya: ${d.arti}`;
            
            showView('tasbih-view');
        }
    
        tasbihTapArea.addEventListener('click', () => {
            if (!currentDzikirId) return;
            const d = dzikirData.find(dz => dz.id === currentDzikirId);
            let s = dzikirState[currentDzikirId];
            if (!s) {
              s = dzikirState[currentDzikirId] = { count: 0, lap: 0 };
            }
            s.count++;
            if (s.count > d.target) { 
                s.count = 1; 
                s.lap = (s.lap || 0) + 1; 
            }
            s.lastUpdate = new Date().toLocaleString('id-ID');
            tasbihCurrentCount.textContent = s.count; 
            saveState();
            if (navigator.vibrate) navigator.vibrate(50);
        });
    
        tasbihResetBtn.addEventListener('click', () => {
            if (!currentDzikirId || !dzikirState[currentDzikirId]) return;
            dzikirState[currentDzikirId].count = 0; 
            dzikirState[currentDzikirId].lap = 0;
            tasbihCurrentCount.textContent = 0; 
            saveState();
        });
    }
    
    // --- QIBLA FEATURE ---
    function setupQiblaFeature() {
        const qiblaBtn = document.getElementById('qibla-btn');
        const qiblaView = document.getElementById('qibla-view');
        const backButton = qiblaView.querySelector('.back-button');
        const compassCircleEl = document.getElementById('qibla-compass-circle');
        const needleEl = document.getElementById('qibla-needle');
        const permissionPromptEl = document.getElementById('qibla-permission-prompt');
        const permissionBtn = document.getElementById('qibla-permission-btn');
        const compassUiContainer = document.getElementById('qibla-compass-container');
        const infoBoxEl = document.getElementById('qibla-info-box');
        const degreeDisplayEl = infoBoxEl.querySelector('.direction-degree');
        const recalibrateBtn = document.getElementById('qibla-recalibrate-btn');

        let qiblaBearing = null;
        let magneticDeclination = 0;
        let isWatching = false;
        let orientationHandlerRef = null;

        const getMagneticDeclination = (latitude, longitude) => {
            const toRad = (angle) => angle * (Math.PI / 180);
            const toDeg = (angle) => angle * (180 / Math.PI);
            const g10 = -29404.8, g11 = -1450.9, h11 = 4652.5;
            const phi = toRad(latitude), lambda = toRad(longitude);
            const cosPhi = Math.cos(phi), sinPhi = Math.sin(phi);
            const cosLambda = Math.cos(lambda), sinLambda = Math.sin(lambda);
            const X = g10 * cosPhi + (g11 * cosLambda + h11 * sinLambda) * sinPhi;
            const Y = g11 * sinLambda - h11 * cosLambda;
            return toDeg(Math.atan2(Y, X));
        };

        function createOrientationHandler() {
            return function(event) {
                let magneticHeading = event.webkitCompassHeading;
                if (typeof magneticHeading === 'undefined' || magneticHeading === null) {
                    magneticHeading = event.alpha;
                }
                if (magneticHeading === null || qiblaBearing === null) return;
                
                const trueHeading = magneticHeading + magneticDeclination;
                const needleRotation = qiblaBearing - trueHeading;
                needleEl.style.transform = `translateX(-50%) rotate(${needleRotation}deg)`;
                
                const alignmentCheck = Math.abs(needleRotation % 360);
                if (alignmentCheck < 2.5 || alignmentCheck > 357.5) {
                    compassCircleEl.classList.add('aligned');
                    if (navigator.vibrate) navigator.vibrate([50]);
                } else {
                    compassCircleEl.classList.remove('aligned');
                }
            };
        }

        function showUi(showCompass, message = '') {
            if (showCompass) {
                permissionPromptEl.style.display = 'none';
                compassUiContainer.style.display = 'flex';
                infoBoxEl.style.display = 'block';
            } else {
                permissionPromptEl.style.display = 'block';
                permissionPromptEl.querySelector('p').textContent = message || 'Fitur ini memerlukan izin lokasi & sensor gerak.';
                compassUiContainer.style.display = 'none';
                infoBoxEl.style.display = 'none';
            }
        }

        function calculateQiblaBearing(lat, lon) {
            const toRad = (deg) => deg * Math.PI / 180;
            const kaabaLat = toRad(21.4225);
            const userLat = toRad(lat);
            const dLon = toRad(39.8262 - lon);
            const y = Math.sin(dLon) * Math.cos(kaabaLat);
            const x = Math.cos(userLat) * Math.sin(kaabaLat) - Math.sin(userLat) * Math.cos(kaabaLat) * Math.cos(dLon);
            let bearing = Math.atan2(y, x) * (180 / Math.PI);
            return (bearing + 360) % 360;
        }

        function stopCompass() {
            if (orientationHandlerRef) {
                window.removeEventListener('deviceorientation', orientationHandlerRef);
            }
            compassCircleEl.classList.remove('aligned');
            isWatching = false;
            orientationHandlerRef = null;
        }

        async function startCompass() {
            stopCompass(); 
            isWatching = true;
            showUi(true);
            degreeDisplayEl.textContent = 'Mendapatkan lokasi & kalibrasi...';

            try {
                const position = await new Promise((resolve, reject) => {
                    navigator.geolocation.getCurrentPosition(resolve, reject, {
                        enableHighAccuracy: true,
                        timeout: 20000,
                        maximumAge: 0
                    });
                });
                
                const userLat = position.coords.latitude;
                const userLon = position.coords.longitude;
                
                qiblaBearing = calculateQiblaBearing(userLat, userLon);
                magneticDeclination = getMagneticDeclination(userLat, userLon);

                if (qiblaBearing !== null) {
                    degreeDisplayEl.textContent = `Arah Kiblat: ${qiblaBearing.toFixed(1)}° dari Utara`;
                    orientationHandlerRef = createOrientationHandler();
                    window.addEventListener('deviceorientation', orientationHandlerRef);
                } else {
                    throw new Error("Gagal menghitung arah kiblat.");
                }

            } catch (error) {
                console.error("Qibla Error:", error.message);
                stopCompass();
                showUi(false, 'Gagal mendapatkan lokasi akurat. Pastikan GPS aktif dan izin diberikan.');
            }
        }
        
        async function requestAndStart() {
            // For iOS 13+ devices
            if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
                try {
                    const permissionState = await DeviceOrientationEvent.requestPermission();
                    if (permissionState !== 'granted') {
                        showUi(false, 'Izin sensor gerak ditolak. Fitur ini memerlukannya.');
                        return;
                    }
                } catch (error) {
                    showUi(false, 'Gagal meminta izin sensor gerak.');
                    return;
                }
            }
            // For other devices
            await startCompass();
        }

        async function initializeQibla() {
            if (!navigator.geolocation || typeof window.DeviceOrientationEvent === "undefined") {
                showUi(false, 'Browser Anda tidak mendukung fitur ini.');
                return;
            }
            try {
                const locationPermission = await navigator.permissions.query({ name: 'geolocation' });
                if (locationPermission.state === 'granted') {
                    await requestAndStart(); // Permission already granted
                } else {
                    showUi(false); // Show the "Start" button
                }
            } catch (e) {
                showUi(false);
            }
        }

        qiblaBtn.addEventListener('click', (e) => {
            e.preventDefault();
            showView('qibla-view');
            closeSidebar();
            initializeQibla();
        });

        permissionBtn.addEventListener('click', requestAndStart);
        recalibrateBtn.addEventListener('click', startCompass);
        backButton.addEventListener('click', stopCompass);
    }
    
    // --- Pengaturan Suara Adzan ---
    function renderFullAdhanSettingsPage() {
        const body = document.getElementById('adhan-settings-body');
        body.innerHTML = ''; 

        const prayerSettingsMap = [
            { key: 'Imsak',   label: translations[currentLanguage]['Imsak'] || 'Imsak' },
            { key: 'Fajr',    label: translations[currentLanguage]['Fajr'] || 'Subuh' },
            { key: 'Sunrise', label: translations[currentLanguage]['Sunrise'] || 'Terbit' },
            { key: 'Dhuhr',   label: translations[currentLanguage]['Dhuhr'] || 'Dzuhur' },
            { key: 'Asr',     label: translations[currentLanguage]['Asr'] || 'Ashar' },
            { key: 'Maghrib', label: translations[currentLanguage]['Maghrib'] || 'Maghrib' },
            { key: 'Isha',    label: translations[currentLanguage]['Isha'] || 'Isya' }
        ];

        prayerSettingsMap.forEach(prayer => {
            const prayerKey = prayer.key;
            const currentSetting = prayerAudioSettings[prayerKey];

            const group = document.createElement('div');
            group.className = 'settings-group';

            const title = document.createElement('h4');
            title.textContent = prayer.label;
            group.appendChild(title);

            const availableOptions = adhanOptionsMap[prayerKey];
            if (!availableOptions) return;
            
            availableOptions.forEach(soundKey => {
                const soundInfo = adhanSoundFiles[soundKey];
                if (!soundInfo) return;

                const isSelected = soundKey === currentSetting.sound;
                
                const wrapper = document.createElement('div');
                wrapper.className = 'selection-item-wrapper';
                
                wrapper.innerHTML = `
                    <div class="selection-item ${isSelected ? 'selected' : ''}" data-prayer="${prayerKey}" data-sound="${soundKey}">
                        <span>${soundInfo.name}</span>
                        <span class="checkmark">✓</span>
                    </div>
                    <div class="volume-control-container ${isSelected && soundKey !== 'none' ? 'active' : ''}">
                        <span class="volume-icon">🔉</span>
                        <input type="range" min="0" max="1" step="0.1" value="${currentSetting.volume}" class="volume-slider" data-prayer="${prayerKey}">
                        <button class="test-sound-btn" data-sound="${soundKey}" aria-label="Test Sound">🎵</button>
                    </div>
                `;
                group.appendChild(wrapper);
            });
            
            body.appendChild(group);
        });
    }

    function setupAdhanSettingsPage() {
        const body = document.getElementById('adhan-settings-body');
        
        body.addEventListener('click', (e) => {
            const item = e.target.closest('.selection-item');
            if (item) {
                const prayerKey = item.dataset.prayer;
                const newSoundKey = item.dataset.sound;
                const currentVolume = prayerAudioSettings[prayerKey].volume;

                prayerAudioSettings[prayerKey] = { sound: newSoundKey, volume: currentVolume };
                localStorage.setItem('prayerAudioSettings', JSON.stringify(prayerAudioSettings));

                const group = item.closest('.settings-group');
                if (group) {
                    const previouslySelected = group.querySelector('.selection-item.selected');
                    if (previouslySelected) {
                        previouslySelected.classList.remove('selected');
                        const prevSliderContainer = previouslySelected.nextElementSibling;
                        if(prevSliderContainer && prevSliderContainer.classList.contains('volume-control-container')){
                            prevSliderContainer.classList.remove('active');
                        }
                    }
                    
                    item.classList.add('selected');
                    
                    const newSliderContainer = item.nextElementSibling;
                    if (newSoundKey !== 'none' && newSliderContainer && newSliderContainer.classList.contains('volume-control-container')) {
                        newSliderContainer.classList.add('active');
                    }
                }
            }

            const testBtn = e.target.closest('.test-sound-btn');
            if (testBtn) {
                const soundKey = testBtn.dataset.sound;
                const slider = testBtn.previousElementSibling;
                const volume = parseFloat(slider.value);
                const soundInfo = adhanSoundFiles[soundKey];

                if (soundInfo && soundInfo.audioId) {
                    const audioElement = document.getElementById(soundInfo.audioId);
                    if (audioElement) {
                        stopAllAdhanAudio();
                        audioElement.volume = volume;
                        audioElement.currentTime = 0;
                        audioElement.play().catch(err => console.error("Test play failed:", err));
                    }
                }
            }
        });
        
        body.addEventListener('input', (e) => {
            if (e.target.classList.contains('volume-slider')) {
                const slider = e.target;
                const prayerKey = slider.dataset.prayer;
                const newVolume = parseFloat(slider.value);
                
                if (prayerAudioSettings[prayerKey]) {
                    prayerAudioSettings[prayerKey].volume = newVolume;
                    localStorage.setItem('prayerAudioSettings', JSON.stringify(prayerAudioSettings));
                }
            }
        });

        document.getElementById('adhan-settings-back-btn').addEventListener('click', () => {
            stopAllAdhanAudio();
            showView('prayer-times-view');
            document.getElementById('settings-modal').style.display = 'flex';
        });
    }
    
    // --- SETTINGS & LANGUAGE ---
    function setupSettings() {
        const darkModeToggle = document.getElementById('dark-mode-toggle');
        const langSelect = document.getElementById('language-select');
        const settingsModal = document.getElementById('settings-modal');
        const enableNotificationsBtn = document.getElementById('enable-notifications-btn');
        const adhanSettingsContainer = document.getElementById('adhan-settings-trigger-container');
    
        const applyTheme = (theme) => { darkModeToggle.checked = theme === 'dark'; document.body.classList.toggle('dark-mode', theme === 'dark'); };
        darkModeToggle.addEventListener('change', () => { const theme = darkModeToggle.checked ? 'dark' : 'light'; localStorage.setItem('theme', theme); applyTheme(theme); });
        applyTheme(localStorage.getItem('theme') || 'light');
    
        window.updateNotificationButtonState = function() {
            if (!("Notification" in window) || !("serviceWorker" in navigator)) {
                enableNotificationsBtn.textContent = 'Tidak Didukung';
                enableNotificationsBtn.disabled = true;
                return;
            }
            switch(Notification.permission) {
                case 'granted':
                    enableNotificationsBtn.textContent = 'Telah Diizinkan';
                    enableNotificationsBtn.disabled = true;
                    break;
                case 'denied':
                    enableNotificationsBtn.textContent = 'Diblokir';
                    enableNotificationsBtn.disabled = true;
                    break;
                default:
                    enableNotificationsBtn.textContent = 'Aktifkan';
                    enableNotificationsBtn.disabled = false;
            }
        }
        
        enableNotificationsBtn.addEventListener('click', () => {
            window.requestNotificationPermission()
              .then(permission => {
                  if (permission === "granted") {
                      new Notification("Notifikasi Diaktifkan!", {
                          body: "Anda akan menerima notifikasi waktu sholat.",
                          icon: 'logo-annur.jpg'
                      });
                  }
                  updateNotificationButtonState();
              })
              .catch(error => {
                  console.log('Permintaan notifikasi ditolak dari modal kustom:', error);
                  updateNotificationButtonState();
              });
        });
        updateNotificationButtonState(); 
    
        function renderAdhanTriggerButton() {
           adhanSettingsContainer.innerHTML = `
                <h4 data-key="settings_adhan_sound">Pengaturan Suara Adzan</h4>
                <div class="settings-menu-item" id="open-adhan-settings-btn" style="border-bottom: none; padding-bottom: 0;">
                    <span>Atur Suara & Volume untuk Tiap Waktu</span>
                    <span class="arrow">&rsaquo;</span>
                </div>`;
           document.getElementById('open-adhan-settings-btn').addEventListener('click', () => {
               settingsModal.style.display = 'none';
               showView('adhan-settings-view');
               renderFullAdhanSettingsPage();
           });
        }
        
        const setLanguage = (lang) => {
            currentLanguage = lang;
            localStorage.setItem('language', lang);
            document.documentElement.lang = lang; 
    
            document.querySelectorAll('[data-key]').forEach(el => {
                const key = el.dataset.key;
                if (translations[lang] && translations[lang][key]) { 
                    el.textContent = translations[lang][key]; 
                }
            });
            
            updateDates();
            generateCalendar();
    
            if (window.latestPrayerTimes) {
                renderPrayerTimes(window.latestPrayerTimes);
                startCountdown(window.latestPrayerTimes);
            }
            renderAdhanTriggerButton();
        };
    
        langSelect.addEventListener('change', () => { 
            setLanguage(langSelect.value); 
        });
    
        const savedLang = localStorage.getItem('language') || 'id';
        langSelect.value = savedLang;
        setLanguage(savedLang);
    
        settingsModal.querySelector('.close-button').addEventListener('click', () => settingsModal.style.display = 'none');
    }

    // --- FUNGSI UNTUK HALAMAN DETAIL APLIKASI ---
    function setupAppDetailPages() {
        const settingsModal = document.getElementById('settings-modal');
        const detailAppBtn = document.getElementById('detail-app-btn');
        const detailViewBackBtn = document.getElementById('detail-view-back-btn');
        
        if (!detailAppBtn) return;

        detailAppBtn.addEventListener('click', () => {
            settingsModal.style.display = 'none';
            showView('app-detail-view');
        });

        detailViewBackBtn.addEventListener('click', () => {
            showView('prayer-times-view'); 
        });

        document.querySelectorAll('#app-detail-view .settings-menu-item').forEach(item => {
            item.addEventListener('click', () => {
                const targetViewId = item.getAttribute('data-target-view');
                if (targetViewId) {
                    showView(targetViewId);
                }
            });
        });
    }
    
    // --- INITIALIZATION ---
    setupNavigation();
    setupSettings(); 
    setupDoaHarian();
    setupQuranFeature();
    setupDzikir();
    setupQiblaFeature();
    setupAppDetailPages();
    setupAdhanSettingsPage();
    setupCustomPermissionModals();
    
    // Panggil fungsi inisialisasi utama yang baru
    initLocationAndPrayerTimes(); 
    
    updateDates();
    generateCalendar();
    showView('prayer-times-view');

    // Minta izin notifikasi setelah beberapa saat jika belum diatur
    setTimeout(() => {
      if (Notification.permission === 'default') {
        window.requestNotificationPermission()
        .then(p => { console.log('Izin Notifikasi:', p); window.updateNotificationButtonState(); })
        .catch(e => { console.log('Permintaan notifikasi ditunda:', e); });
      }
    }, 5000);
});

// --- PENDAFTARAN SERVICE WORKER & PENYIMPANAN PERMANEN ---
window.addEventListener('load', () => {
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('sw.js')
      .then(registration => {
        console.log('Service Worker berhasil didaftarkan:', registration);
      })
      .catch(error => {
        console.error('Pendaftaran Service Worker gagal:', error);
      });
  } else {
    console.log('Browser tidak mendukung Service Worker.');
  }

  requestPersistentStorage();
});
</script>
</body>
</html>
